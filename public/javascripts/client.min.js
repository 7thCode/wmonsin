var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(r,e,t,o){t.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"Test"},r.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),e.otherwise("/")}]),app.filter("message",function(){return function(r){var e="?????";switch(r){case"front":e="問診票";break;case"stuff":e="スタッフ"}return e}});
var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(r,e,o){o.debugInfoEnabled(!1),r.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),e.otherwise("/")}]),app.filter("message",function(){return function(r){var e="?????";switch(r){case"front":e="問診票";break;case"stuff":e="スタッフ"}return e}});
var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(o){}]);
var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(o){}]);
"use strict";var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,r,a){r.debugInfoEnabled(!1),a.defaults.headers.common={"x-requested-with":"Test"},e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});
"use strict";var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","pascalprecht.translate"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,a){a.debugInfoEnabled(!1),e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});
"use strict";function TodayQuery(){var e=new Date;e.setHours(23,59,59,99);var t=new Date;return t.setHours(0,0,0,1),{$and:[{Date:{$lte:e}},{Date:{$gt:t}}]}}function PatientsList(e,t,n){var t=TodayQuery();e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){e&&0==e.code&&n(e.value,t)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function fileUpload(e,t,n,o){e.$watch(o,function(t){if(e.formUpload=!1,null!=t)for(var n=0;n<t.length;n++){{e.files}!function(e){a(e)}(t[n])}});var a=function(e){e.upload=n.upload({url:"/image/upload",method:"POST",file:e,fileFormDataName:"myFile"}),e.upload.then(function(n){t(function(){e.result=n.data})},function(e){e.status>0})}}var _this=this,controllers=angular.module("AccountControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate","ngFileUpload"]);controllers.value("Global",{socket:null}),controllers.value("CurrentPatient",{id:""}),controllers.value("CurrentView",{Page:0,Data:{}}),controllers.value("CurrentAccount",{username:"",type:""}),controllers.factory("ViewItem",["$resource",function(e){return e("/view",{},{})}]),controllers.factory("Login",["$resource",function(e){return e("/account/login",{},{login:{method:"POST"}})}]),controllers.factory("Logout",["$resource",function(e){return e("/account/logout",{},{logout:{method:"POST"}})}]),controllers.factory("AccountQuery",["$resource",function(e){return e("/account/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Account",["$resource",function(e){return e("/account/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("AccountPassword",["$resource",function(e){return e("/account/password/:id",{},{update:{method:"PUT"}})}]),controllers.factory("AccountCreate",["$resource",function(e){return e("/account/create",{},{})}]),controllers.factory("PatientAccept",["$resource",function(e){return e("/patient/accept",{},{})}]),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("PatientCount",["$resource",function(e){return e("/patient/count/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("PatientStatus",["$resource",function(e){return e("/patient/status/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewCreate",["$resource",function(e){return e("/view/create",{},{})}]),controllers.factory("View",["$resource",function(e){return e("/view/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Config",["$resource",function(e){return e("/config",{},{update:{method:"PUT"}})}]),controllers.factory("Pdf",["$resource",function(e){return e("/pdf/:id",{},{})}]),controllers.controller("StartController",["$scope","$state","CurrentAccount",function(e,t,n){""!=n.username?(e.username=n.username,e.type=n.type):t.go("start")}]),controllers.controller("ApplicationController",["$scope","$rootScope","$state","$mdDialog","$mdToast","Login","Logout","CurrentAccount","Global",function(e,t,n,o,a,i,c,r,l){if(e.goBack=function(){window.history.back()},e.goTop=function(){n.go("start")},e.goConfig=function(){n.go("controlles")},e.goEdit=function(){n.go("departments")},e.goPatient=function(){e.mode="Patient",n.go("patients")},e.goAccount=function(){e.mode="Account",n.go("accounts")},e.showLoginDialog=function(){o.show({controller:"LoginDialogController",templateUrl:"/backend/partials/account/logindialog",targetEvent:null}).then(function(n){var o=new i;o.username=n.items.username,o.password=n.items.password,o.$login(function(n){n?(0==n.code&&(r.username=n.value.username,r.type=n.value.type,e.username=n.value.username,e.type=n.value.type,localStorage.setItem("account",JSON.stringify(r)),t.$broadcast("Login")),a.show(a.simple().content(n.message))):a.show(a.simple().content("login error"))})},function(){})},e.Logout=function(){var o=new c;o.$logout(function(o){o?(0==o.code&&(r.username="",r.type="",e.username="",e.type="",localStorage.removeItem("account"),t.$broadcast("Logout"),n.go("start")),a.show(a.simple().content(o.message))):a.show(a.simple().content("logout error"))})},null==l.socket&&(l.socket=io.connect()),null!=localStorage.getItem("account")){var s=JSON.parse(localStorage.getItem("account"));r.username=s.username,r.type=s.type}else e.showLoginDialog();e.username=r.username,e.type=r.type,e.mode="Account"}]),controllers.controller("PatientsController",["$scope","$state","$mdDialog","$mdBottomSheet","$mdToast","Patient","PatientAccept","PatientQuery","PatientCount","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,i,c,r,l,s,u,g){""!=s.username?(e.username=s.username,e.type=s.type,e.progress=!0,PatientsList(r,{},function(t){e.patients=t,e.progress=!1}),e.showPatientDescription=function(e){u.id=e,t.go("description")},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",o.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showPatientAcceptDialog=function(t){var o=TodayQuery();l.query({query:encodeURIComponent(JSON.stringify(o))},function(o){if(o&&0==o.code){var i={count:0};i.count=o.value,n.show({controller:"PatientAcceptDialogController",templateUrl:"/backend/partials/patient/patientacceptdialog",targetEvent:t,locals:{items:i}}).then(function(t){var n=new c;n.Input={},n.Information={},n.Information.name=t.items.name;var o=new Date,l=("0"+o.getHours()).slice(-2),s=("0"+o.getMinutes()).slice(-2),u=("0"+o.getSeconds()).slice(-2);n.Information.time=l+":"+s+":"+u,t.items.kana=t.items.kana.replace(/[ぁ-ん]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}),n.Information.kana=t.items.kana,n.Information.insurance=t.items.insurance,n.Category=t.items.category,n.Sequential=i.count,e.progress=!0,n.$save({},function(t){t?0==t.code?PatientsList(r,{},function(n){e.progress=!1,g.socket.emit("server",{value:"1"}),e.patients=n,a.show(a.simple().content(t.message))}):a.show(a.simple().content(t.message)):a.show(a.simple().content("save error"))})},function(){})}})},e.$on("Login",function(){e.progress=!0,PatientsList(r,{},function(t){e.patients=t,e.progress=!1})}),e.$on("Logout",function(){s.username="",s.type="",e.patients=[]}),e.$on("Update",function(){e.progress=!0,PatientsList(r,{},function(t){e.patients=t,e.progress=!1})}),g.socket.on("client",function(t){"1"===t.value&&(e.progress=!0,PatientsList(r,{},function(t){e.patients=t,e.progress=!1}))})):t.go("start")}]),controllers.controller("DescriptionController",["$scope","$mdBottomSheet","$mdToast","Patient","PatientStatus","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,i,c,r){if(c){e.selectedIndex=0,e.$watch("selectedIndex",function(t,a){var i=new o;i.$get({id:c.id},function(t){t?0==t.code?(e.Input=[],_.each(t.value.Input,function(n,o,a){if("picture"==n.type){var i=new fabric.Canvas("schema");i.loadFromJSON(JSON.stringify(n.value),i.renderAll.bind(i),function(e,t){})}e.Input.push(n),e.Information=t.value.Information})):n.show(n.simple().content(t.message)):n.show(n.simple().content("patient error"))})});var l=new a;l.$get({id:c.id},function(t){t?0==t.code?e.IsDone="Done"==t.value:n.show(n.simple().content(t.message)):n.show(n.simple().content("patient status error"))}),e.icon="vertical_align_top",e.showSheet=function(n){e.icon="vertical_align_bottom",t.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:n}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.done=function(){var e=new o;e.$remove({id:c.id},function(e){n.show(e?n.simple().content(e.message):n.simple().content("remove patient error"))})},e.download=function(e){var t=document.getElementById("schema");Canvas2Image.saveAsPNG(t)},e.$watch("IsDone",function(){if(null!=e.IsDone){var t=new a;t.$get({id:c.id},function(o){o?0==o.code?1==e.IsDone?"Done"!=o.value&&(t.Status="Done",t.$update({id:c.id},function(e){e?(0==e.code&&r.socket.emit("server",{value:"1"}),n.show(n.simple().content("Status Updated."))):n.show(n.simple().content("status update error"))})):"Accepted"!=o.value&&(t.Status="Accepted",t.$update({id:c.id},function(e){e?(0==e.code&&r.socket.emit("server",{value:"1"}),n.show(n.simple().content(e.message))):n.show(n.simple().content("login error"))})):n.show(n.simple().content(o.message)):n.show(n.simple().content("login error"))})}})}}]),controllers.controller("AccountsController",["$scope","$state","$mdDialog","$mdToast","Account","AccountQuery","AccountCreate","AccountPassword","CurrentAccount",function(e,t,n,o,a,i,c,r,l){""!=l.username?(e.username=l.username,e.type=l.type,e.progress=!0,List(i,{},function(t){e.progress=!1,e.accounts=t}),e.showRegisterDialog=function(){n.show({controller:"RegisterDialogController",templateUrl:"/backend/partials/account/registerdialog",targetEvent:null}).then(function(t){var n=new c;n.username=t.items.username,n.password=t.items.password,n.type=t.items.type,e.progress=!0,n.$save({},function(t){t?(0==t.code&&List(i,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountDeleteDialog=function(t){n.show({controller:"AccountDeleteDialogController",templateUrl:"/backend/partials/account/deletedialog",targetEvent:t}).then(function(n){var c=new a;e.progress=!0,c.$remove({id:t},function(t){t?0==t.code&&(List(i,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountUpdateDialog=function(t){var c=new a;c.$get({id:t},function(c){c&&(0==c.code?(e.items=c.value,e.items.password="",n.show({controller:"AccountUpdateDialogController",templateUrl:"/backend/partials/account/accountdialog",targetEvent:t,locals:{items:e.items}}).then(function(n){switch(n.a){case 1:var c=new r;c.password=n.items.password,c.$update({id:t},function(e){o.show(e?o.simple().content(e.message):o.simple().content("Password Updated error."))});case 2:var c=new a;c.username=n.items.username,c.type=n.items.type,e.progress=!0,c.$update({id:t},function(t){t?0==t.code?List(i,{},function(n){e.accounts=n,e.progress=!1,o.show(o.simple().content(t.message))}):o.show(o.simple().content(t.message)):o.show(o.simple().content("account Updated error."))})}},function(){})):o.show(o.simple().content(c.message)))})},e.$on("Login",function(){e.progress=!0,List(i,{},function(t){e.accounts=t,e.progress=!1})}),e.$on("Logout",function(){e.accounts=[]}),e.$on("Update",function(){e.progress=!0,List(i,{},function(t){e.accounts=t,e.progress=!1})})):t.go("start")}]),controllers.controller("DepartmentsController",["$scope","$state","$mdDialog","$mdToast","CurrentView","ViewCreate","View","ViewQuery",function(e,t,n,o,a,i,c,r){e.progress=!0,List(r,{},function(t){e.Departments=t,e.progress=!1}),e.back=function(){window.history.back()},e.showDepartmentCreateDialog=function(){n.show({controller:"DepartmentCreateDialogController",templateUrl:"/backend/partials/edit/departmentcreatedialog",targetEvent:null}).then(function(t){var n=new i;n.Name=t.items.department,n.$save({},function(t){t?0==t.code?(e.progress=!0,List(r,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})},e.showDepartmentCopyDialog=function(t){var a=new c;a.$get({id:t},function(t){n.show({controller:"DepartmentCopyDialogController",templateUrl:"/backend/partials/edit/departmentcopydialog",targetEvent:null,locals:{items:a}}).then(function(n){var a=new i;a.Pages=t.value.Pages,a.Name=n.items.department,a.$save({},function(t){t?0==t.code?(e.progress=!0,List(r,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})})},e.DepartmentUpdate=function(n){var o=new c;o.$get({id:n},function(n){a.Data=n.value,e.Pages=a.Data.Pages,t.go("department")})},e.showDepartmentDeleteDialog=function(t){n.show({controller:"DepartmentDeleteDialogController",templateUrl:"/backend/partials/edit/departmentdeletedialog",targetEvent:t}).then(function(n){var a=new c;e.progress=!0,a.$remove({id:t},function(t){t?0==t.code?(e.progress=!0,List(r,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})}}]),controllers.controller("DepartmentEditController",["$scope","$state","$mdDialog","$mdToast","CurrentView","View",function(e,t,n,o,a,i){e.Pages=a.Data.Pages,e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e-1],a.Data.Pages[e-1]=t}},e.down=function(e){if(e<a.Data.Pages.length-1){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e+1],a.Data.Pages[e+1]=t}},e.DepartmentUpdate=function(){var e=new i;e.Name=a.Data.Name,e.Pages=a.Data.Pages,e.$update({id:a.Data._id},function(e){o.show(e?0==e.code?o.simple().content(e.message):o.simple().content(e.message):o.simple().content("account Updated error."))})},e.showPageCreateDialog=function(){n.show({controller:"PageCreateDialogController",templateUrl:"/backend/partials/edit/pagecreatedialog",targetEvent:null}).then(function(e){var t=e.items.title,n={headline:t,items:[],picture:[]};a.Data.Pages.push(n)},function(){})},e.PageUpdate=function(e){a.Page=e,t.go("page")},e.showPageDeleteDialog=function(t){n.show({controller:"PageDeleteDialogController",templateUrl:"/backend/partials/edit/pagedeletedialog",targetEvent:t}).then(function(n){a.Data.Pages[t]=null,a.Data.Pages=_.compact(a.Data.Pages),e.Pages=a.Data.Pages},function(){})}}]),controllers.controller("PageEditController",["$scope","$state","$mdDialog","CurrentView","View",function(e,t,n,o,a){e.Page=o.Data.Pages[o.Page],e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e-1],o.Data.Pages[o.Page].items[e-1]=t}},e.down=function(e){if(e<o.Data.Pages[o.Page].items.length-1){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e+1],o.Data.Pages[o.Page].items[e+1]=t}},e.showTextCreateDialog=function(){n.show({controller:"TextCreateDialogController",templateUrl:"/backend/partials/edit/item/text/textcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"text",items:[{name:"required",message:"Required"},{name:"md-maxlength",message:"Max"}]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showCheckCreateDialog=function(){n.show({controller:"CheckCreateDialogController",templateUrl:"/backend/partials/edit/item/check/checkcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name+"-"+e.items.label,model:"",type:"check"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showSelectCreateDialog=function(){n.show({controller:"SelectCreateDialogController",templateUrl:"/backend/partials/edit/item/select/selectcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"select",items:e.tags};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showNumericCreateDialog=function(){n.show({controller:"NumericCreateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"numeric"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showPictureCreateDialog=function(){n.show({controller:"PictureCreateDialogController",templateUrl:"/backend/partials/edit/item/picture/picturecreatedialog",targetEvent:null}).then(function(e){var t={height:600,width:300,path:"images/schema.png",type:"picture",model:"",name:"痛いところ",label:""};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showButtonCreateDialog=function(){var e={type:"button",validate:!0,"class":"md-accent"};n.show({controller:"ButtonCreateDialogController",templateUrl:"/backend/partials/edit/item/button/buttoncreatedialog",targetEvent:null,locals:{items:e}}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"button",validate:e.items.validate,path:e.items.path,"class":e.items["class"]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showTextUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"TextUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/textupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showCheckUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];t.name=t.name.split("-")[0],n.show({controller:"CheckUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/checkupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){t.items.name=t.items.name+"-"+t.items.label,o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showSelectUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"SelectUpdateDialogController",templateUrl:"/backend/partials/edit/item/select/selectupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showNumericUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"NumericUpdateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showPictureUpdateDialog=function(e){var t=o.Data.Pages[o.Page].picture[0];n.show({controller:"PictureUpdateDialogController",templateUrl:"/backend/partials/edit/item/picture/pictureupdatedialog",targetEvent:null,locals:{items:t}}).then(function(e){o.Data.Pages[o.Page].picture[0]=e.items},function(){})},e.showButtonUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"ButtonUpdateDialogController",templateUrl:"/backend/partials/edit/item/button/buttonupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showTextDeleteDialog=function(e){n.show({controller:"TextDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/textdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showCheckDeleteDialog=function(e){n.show({controller:"CheckDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/checkdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showSelectDeleteDialog=function(e){n.show({controller:"SelectDeleteDialogController",templateUrl:"/backend/partials/edit/item/select/selectdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showNumericDeleteDialog=function(e){n.show({controller:"NumericDeleteDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showPictureDeleteDialog=function(e){n.show({controller:"PictureDeleteDialogController",templateUrl:"/backend/partials/edit/item/picture/picturedeletedialog",targetEvent:e}).then(function(e){o.Data.Pages[o.Page].picture[0]=null,o.Data.Pages[o.Page].picture=_.compact(o.Data.Pages[o.Page].picture)},function(){})},e.showButtonDeleteDialog=function(e){n.show({controller:"ButtonDeleteDialogController",templateUrl:"/backend/partials/edit/item/button/buttondeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})}}]),controllers.controller("ControllpanelController",["$scope","$mdToast","$mdBottomSheet","$mdDialog","Config",function(e,t,n,o,a){var i=new a;i.$get({},function(n){n?0==n.code?e.config=n.value:t.show(t.simple().content(n.message)):t.show(t.simple().content("config get error."))}),e.showNotificationDialog=function(){o.show({controller:"NotificationDialogController",templateUrl:"/backend/partials/controll/notification",targetEvent:""}).then(function(n){var o=new a;o.body=e.config,o.$update({},function(e){t.show(0==e.code?t.simple().content("Updated."):t.simple().content(e.message))})},function(){})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})}}]),controllers.controller("PatientSheetControl",["$scope","$mdBottomSheet","$location","CurrentPatient","Pdf",function(e,t,n,o,a){o&&(e.items=[{name:"Archive",icon:"archive"},{name:"Mail",icon:"mail"},{name:"Message",icon:"message"},{name:"Copy",icon:"content_copy"},{name:"Create",icon:"create"},{name:"Inbox",icon:"inbox"}],e.ItemClick=function(n){t.hide(e.items[n]);var i=new a;i.$get({id:o.id},function(e){window.location.href="/output/"+e.value})})}]),controllers.controller("LoginDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("RegisterDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.iconsize="42",e.onEnter=function(){e.iconsize="52"},e.onLeave=function(){e.iconsize="42"},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.changePassword=function(n){e.a=1,t.hide(e)},e.answer=function(n){e.a=2,t.hide(e)}}]),controllers.controller("NotificationDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PatientAcceptDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.items=o,e.categories=[],e.progress=!0,List(n,{},function(t){_.each(t,function(t,n){e.categories.push(t.Name)}),e.progress=!1}),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCreateDialogController",["$scope","$mdDialog","ViewQuery",function(e,t,n){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCopyDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectCreateDialogController",["$scope","$mdDialog",function(e,t){var n=_this;n.tags=[],e.tags=angular.copy(n.tags),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureCreateDialogController",["$scope","$mdDialog","$timeout","Upload",function(e,t,n,o){e.showUpload=function(){fileUpload(e,t,n,"a")},e.hide=function(){o.hide()},e.cancel=function(){o.cancel()},e.answer=function(t){o.hide(e)}}]),controllers.controller("ButtonCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]);
"use strict";var app=angular.module("PatientsApplication",["ui.router","PatientsControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,r,t,a){t.debugInfoEnabled(!1),a.defaults.headers.common={"x-requested-with":"Test"},e.state("browseS",{url:"/browseS",templateUrl:"/front/partials/browseS",controller:"BrowseSController"}).state("browse",{url:"/browse/:page",templateUrl:function(e){e.page;return"/front/partials/browse"},controller:"BrowseController"}).state("write",{url:"/write",templateUrl:"/front/partials/write",controller:"WriteController"}),r.otherwise("partials/browseS")}]),app.filter("status",function(){return function(e){var r="";switch(e){case"Init":r="受付済み";break;case"Accepted":r="問診済み";break;case"Done":r="診療済み"}return r}}),app.filter("message",function(){return function(e){var r="";switch(e){case"required":r="必ず入力してください.";break;case"maxlength":r="もう少し短くしてください.";break;case"itai":r="痛い";break;case"shibire":r="痺れ";break;case"hare":r="腫れ";break;case"clear":r="消す"}return r}});
"use strict";function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function PatientsList(e,t,n){var i=new Date;i.setHours(23,59,59,99);var r=new Date;r.setHours(0,0,0,1);var t={$and:[{Date:{$lte:i}},{Date:{$gt:r}}]};e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){null!=e&&0==e.code&&n(e.value,t)})}var controllers=angular.module("PatientsControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate"]),Browser=function(){function e(){this.name=window.navigator.userAgent.toLowerCase(),this.isIE=this.name.indexOf("msie")>=0||this.name.indexOf("trident")>=0,this.isiPhone=this.name.indexOf("iphone")>=0,this.isiPod=this.name.indexOf("ipod")>=0,this.isiPad=this.name.indexOf("ipad")>=0,this.isiOS=this.isiPhone||this.isiPod||this.isiPad,this.isAndroid=this.name.indexOf("android")>=0,this.isPhone=this.isiOS||this.isAndroid,this.isTablet=this.isiPad||this.isAndroid&&this.name.indexOf("mobile")<0,this.isIE&&(this.verArray=/(msie|rv:?)\s?([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isiOS&&(this.verArray=/(os)\s([0-9]{1,})([\_0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isAndroid&&(this.verArray=/(android)\s([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10)))}return e}();controllers.value("Global",{socket:null}),controllers.value("Views",{Data:[]}),controllers.value("CurrentPatient",{Information:{name:"",insurance:""},Status:"",Category:"",Input:{},Sequential:0}),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.controller("BrowseSController",["$scope","$stateParams","$location","Patient","PatientQuery","CurrentPatient","Global","ViewQuery","Views",function(e,t,n,i,r,o,a,s,u){List(s,{},function(t){PatientsList(r,{},function(n){e.patients=n,u.Data=t})}),e.next=function(t){var r=new i;r.$get({id:t},function(i){null!=i&&0==i.code&&(o.id=t,o.Category=i.value.Category,o.Information=i.value.Information,o.Sequential=i.value.Sequential,e.Information=o.Information,e.Input=o.Input,e.Sequential=o.Sequential,n.path("/browse/0"))})},null==a.socket&&(a.socket=io.connect()),a.socket.on("client",function(t){"1"===t.value&&PatientsList(r,{},function(t){e.patients=t})})}]),controllers.controller("BrowseController",["$scope","$stateParams","$location","CurrentPatient","Views",function(e,t,n,i,r){e.Input=i.Input;var o=t.page,a="rgba(200, 20, 30, 0.4)",s=_.filter(r.Data,function(e){return e.Name==i.Category});if(e.contents=s[0].Pages[o],e.contents.picture.length>0){var u=new fabric.Canvas("schema");_.map(e.contents.picture,function(t,n){u.setBackgroundImage(t.path,u.renderAll.bind(u),{backgroundImageOpacity:1,backgroundImageStretch:!1}),null==e.Input[t.name]&&fabric.Image.fromURL(t.path,function(e){});var i=JSON.stringify(e.Input[t.name]);u.loadFromJSON(i,u.renderAll.bind(u),function(e,t){})}),u.on({"touch:gesture":function(e){},"touch:drag":function(e){},"touch:orientation":function(e){},"touch:shake":function(e){},"touch:longpress":function(e){},"mouse:up":function(e){var t=20,n=new Browser;if(n.isTablet)var i=new fabric.Circle({radius:t,fill:a,left:e.e.changedTouches[0].clientX-t/2-u._offset.left,top:e.e.changedTouches[0].clientY-t/2-u._offset.top});else var i=new fabric.Circle({radius:t,fill:a,left:e.e.layerX-t/2,top:e.e.layerY-t/2});u.add(i)}})}e.clearPicture=function(){u.clear().renderAll()},e.setColor=function(e){a=e},e.next=function(t){_.map(e.contents.items,function(t,n){if("check"==t.type){var i=t.name.split("-"),r=i[1];t.model||(r=!1),e.Input[t.name]={name:i[0],value:r,type:t.type}}else e.Input[t.name]={name:t.name,value:t.model,type:t.type}}),_.map(e.contents.picture,function(t,n){e.Input[t.name]={name:t.name,value:u.toJSON(),type:t.type}}),i.Input=e.Input,n.path(t)}}]),controllers.controller("ConfirmController",["$scope","$stateParams","CurrentPatient","Patient","Global",function(e,t,n,i,r){e.Input=n.Input}]),controllers.controller("WriteController",["$scope","$stateParams","$location","CurrentPatient","Patient","Global",function(e,t,n,i,r,o){e.Input=i.Input,e.send=!0;var a=new r;a.Input=i.Input,a.Sequential=i.Sequential,a.Status="Accepted",a.$update({id:i.id},function(t,r){i.Input={},n.path("/browseS"),o.socket.emit("server",{value:"1"}),e.send=!1})}]);