"use strict";var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,r,o){r.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("deep-orange").warnPalette("red")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});
var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(r,e,o){o.debugInfoEnabled(!1),r.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),e.otherwise("/")}]),app.filter("message",function(){return function(r){var e="?????";switch(r){case"front":e="問診票";break;case"stuff":e="スタッフ"}return e}});
"use strict";var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(o){}]);
var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(o){}]);
"use strict";function TodayQuery(){var e=new Date;e.setHours(23,59,59,99);var t=new Date;return t.setHours(0,0,0,1),{$and:[{Date:{$lte:e}},{Date:{$gt:t}}]}}function PatientsList(e,t,n){var t=TodayQuery();e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){e&&0==e.code&&n(e.value,t)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function fileUpload(e,t,n,o){e.$watch(o,function(t){if(e.formUpload=!1,null!=t)for(var n=0;n<t.length;n++)e.files,!function(e){a(e)}(t[n])});var a=function(e){e.upload=n.upload({url:"/image/upload",method:"POST",file:e,fileFormDataName:"myFile"}),e.upload.then(function(n){t(function(){e.result=n.data})},function(e){e.status>0})}}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function PatientsList(e,t,n){var o=new Date;o.setHours(23,59,59,99);var a=new Date;a.setHours(0,0,0,1);var t={$and:[{Date:{$lte:o}},{Date:{$gt:a}}]};e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){null!=e&&0==e.code&&n(e.value,t)})}function TodayQuery(){var e=new Date;e.setHours(23,59,59,99);var t=new Date;return t.setHours(0,0,0,1),{$and:[{Date:{$lte:e}},{Date:{$gt:t}}]}}function PatientsList(e,t,n){var t=TodayQuery();e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){e&&0==e.code&&n(e.value,t)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function PatientsList(e,t,n){var o=new Date;o.setHours(23,59,59,99);var a=new Date;a.setHours(0,0,0,1);var t={$and:[{Date:{$lte:o}},{Date:{$gt:a}}]};e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){null!=e&&0==e.code&&n(e.value,t)})}function TodayQuery(){var e=new Date;e.setHours(23,59,59,99);var t=new Date;return t.setHours(0,0,0,1),{$and:[{Date:{$lte:e}},{Date:{$gt:t}}]}}function PatientsList(e,t,n){var t=TodayQuery();e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){e&&0===e.code&&n(e.value,t)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0===e.code&&n(e.value)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function PatientsList(e,t){var n=new Date;n.setHours(23,59,59,99);var o=new Date;o.setHours(0,0,0,1);var a={$and:[{Date:{$lte:n}},{Date:{$gt:o}}]};e.query({query:encodeURIComponent(JSON.stringify(a))},function(e,n){null!=e&&0==e.code&&t(e.value,n)})}var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("deep-orange").warnPalette("red")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"Test"},e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var app=angular.module("TopApplication",["ui.router","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/",templateUrl:"partials/logo",controller:"TopController"}),t.otherwise("/")}]),app.filter("message",function(){return function(e){var t="?????";switch(e){case"front":t="問診票";break;case"stuff":t="スタッフ"}return t}});var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var controllers=angular.module("TopControllers",["ngMaterial","ngResource","ngAnimate"]);controllers.controller("TopController",["$scope",function(e){}]);var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"Test"},e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","pascalprecht.translate"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});var _this=this,controllers=angular.module("AccountControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate","ngFileUpload"]);controllers.value("Global",{socket:null}),controllers.value("CurrentPatient",{id:""}),controllers.value("CurrentView",{Page:0,Data:{}}),controllers.value("CurrentAccount",{username:"",type:""}),controllers.factory("ViewItem",["$resource",function(e){return e("/view",{},{})}]),controllers.factory("Login",["$resource",function(e){return e("/account/login",{},{login:{method:"POST"}})}]),controllers.factory("Logout",["$resource",function(e){return e("/account/logout",{},{logout:{method:"POST"}})}]),controllers.factory("AccountQuery",["$resource",function(e){return e("/account/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Account",["$resource",function(e){return e("/account/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("AccountPassword",["$resource",function(e){return e("/account/password/:id",{},{update:{method:"PUT"}})}]),controllers.factory("AccountCreate",["$resource",function(e){return e("/account/create",{},{})}]),controllers.factory("PatientAccept",["$resource",function(e){return e("/patient/accept",{},{})}]),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("PatientCount",["$resource",function(e){return e("/patient/count/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("PatientStatus",["$resource",function(e){return e("/patient/status/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewCreate",["$resource",function(e){return e("/view/create",{},{})}]),controllers.factory("View",["$resource",function(e){return e("/view/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Config",["$resource",function(e){return e("/config",{},{update:{method:"PUT"}})}]),controllers.factory("Pdf",["$resource",function(e){return e("/pdf/:id",{},{})}]),controllers.controller("StartController",["$scope","$state","CurrentAccount",function(e,t,n){""!=n.username?(e.username=n.username,e.type=n.type):t.go("start")}]),controllers.controller("ApplicationController",["$scope","$rootScope","$state","$mdDialog","$mdToast","Login","Logout","CurrentAccount","Global",function(e,t,n,o,a,r,i,l,c){if(e.goBack=function(){window.history.back()},e.goTop=function(){n.go("start")},e.goConfig=function(){n.go("controlles")},e.goEdit=function(){n.go("departments")},e.goPatient=function(){e.mode="Patient",n.go("patients")},e.goAccount=function(){e.mode="Account",n.go("accounts")},e.showLoginDialog=function(){o.show({controller:"LoginDialogController",templateUrl:"/backend/partials/account/logindialog",targetEvent:null}).then(function(n){var o=new r;o.username=n.items.username,o.password=n.items.password,o.$login(function(n){n?(0==n.code&&(l.username=n.value.username,l.type=n.value.type,e.username=n.value.username,e.type=n.value.type,localStorage.setItem("account",JSON.stringify(l)),t.$broadcast("Login")),a.show(a.simple().content(n.message))):a.show(a.simple().content("login error"))})},function(){})},e.Logout=function(){var o=new i;o.$logout(function(o){o?(0==o.code&&(l.username="",l.type="",e.username="",e.type="",localStorage.removeItem("account"),t.$broadcast("Logout"),n.go("start")),a.show(a.simple().content(o.message))):a.show(a.simple().content("logout error"))})},null==c.socket&&(c.socket=io.connect()),null!=localStorage.getItem("account")){var s=JSON.parse(localStorage.getItem("account"));l.username=s.username,l.type=s.type}else e.showLoginDialog();e.username=l.username,e.type=l.type,e.mode="Account"}]),controllers.controller("PatientsController",["$scope","$state","$mdDialog","$mdBottomSheet","$mdToast","Patient","PatientAccept","PatientQuery","PatientCount","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,r,i,l,c,s,u,p){""!=s.username?(e.username=s.username,e.type=s.type,e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1}),e.showPatientDescription=function(e){u.id=e,t.go("description")},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",o.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showPatientAcceptDialog=function(t){var o=TodayQuery();c.query({query:encodeURIComponent(JSON.stringify(o))},function(o){if(o&&0==o.code){var r={count:0};r.count=o.value,n.show({controller:"PatientAcceptDialogController",templateUrl:"/backend/partials/patient/patientacceptdialog",targetEvent:t,locals:{items:r}}).then(function(t){var n=new i;n.Input={},n.Information={},n.Information.name=t.items.name;var o=new Date,c=("0"+o.getHours()).slice(-2),s=("0"+o.getMinutes()).slice(-2),u=("0"+o.getSeconds()).slice(-2);n.Information.time=c+":"+s+":"+u,t.items.kana=t.items.kana.replace(/[ぁ-ん]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}),n.Information.kana=t.items.kana,n.Information.insurance=t.items.insurance,n.Category=t.items.category,n.Sequential=r.count,e.progress=!0,n.$save({},function(t){t?0==t.code?PatientsList(l,{},function(n){e.progress=!1,p.socket.emit("server",{value:"1"}),e.patients=n,a.show(a.simple().content(t.message))}):a.show(a.simple().content(t.message)):a.show(a.simple().content("save error"))})},function(){})}})},e.$on("Login",function(){e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1})}),e.$on("Logout",function(){s.username="",s.type="",e.patients=[]}),e.$on("Update",function(){e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1})}),p.socket.on("client",function(t){"1"===t.value&&(e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1}))})):t.go("start")}]),controllers.controller("DescriptionController",["$scope","$mdBottomSheet","$mdToast","Patient","PatientStatus","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,r,i,l){if(i){e.selectedIndex=0,e.$watch("selectedIndex",function(t,a){var r=new o;r.$get({id:i.id},function(t){t?0==t.code?(e.Input=[],_.each(t.value.Input,function(n,o,a){if("picture"==n.type){var r=new fabric.Canvas("schema");r.loadFromJSON(JSON.stringify(n.value),r.renderAll.bind(r),function(e,t){})}e.Input.push(n),e.Information=t.value.Information})):n.show(n.simple().content(t.message)):n.show(n.simple().content("patient error"))})});var c=new a;c.$get({id:i.id},function(t){t?0==t.code?e.IsDone="Done"==t.value:n.show(n.simple().content(t.message)):n.show(n.simple().content("patient status error"))}),e.icon="vertical_align_top",e.showSheet=function(n){e.icon="vertical_align_bottom",t.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:n}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.done=function(){var e=new o;e.$remove({id:i.id},function(e){n.show(n.simple().content(e?e.message:"remove patient error"))})},e.download=function(e){var t=document.getElementById("schema");Canvas2Image.saveAsPNG(t)},e.$watch("IsDone",function(){if(null!=e.IsDone){var t=new a;t.$get({id:i.id},function(o){o?0==o.code?1==e.IsDone?"Done"!=o.value&&(t.Status="Done",t.$update({id:i.id},function(e){e?(0==e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content("Status Updated."))):n.show(n.simple().content("status update error"))})):"Accepted"!=o.value&&(t.Status="Accepted",t.$update({id:i.id},function(e){e?(0==e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content(e.message))):n.show(n.simple().content("login error"))})):n.show(n.simple().content(o.message)):n.show(n.simple().content("login error"))})}})}}]),controllers.controller("AccountsController",["$scope","$state","$mdDialog","$mdToast","Account","AccountQuery","AccountCreate","AccountPassword","CurrentAccount",function(e,t,n,o,a,r,i,l,c){""!=c.username?(e.username=c.username,e.type=c.type,e.progress=!0,List(r,{},function(t){e.progress=!1,e.accounts=t}),e.showRegisterDialog=function(){n.show({controller:"RegisterDialogController",templateUrl:"/backend/partials/account/registerdialog",targetEvent:null}).then(function(t){var n=new i;n.username=t.items.username,n.password=t.items.password,n.type=t.items.type,e.progress=!0,n.$save({},function(t){t?(0==t.code&&List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountDeleteDialog=function(t){n.show({controller:"AccountDeleteDialogController",templateUrl:"/backend/partials/account/deletedialog",targetEvent:t}).then(function(n){var i=new a;e.progress=!0,i.$remove({id:t},function(t){t?0==t.code&&(List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountUpdateDialog=function(t){var i=new a;i.$get({id:t},function(i){i&&(0==i.code?(e.items=i.value,e.items.password="",n.show({controller:"AccountUpdateDialogController",templateUrl:"/backend/partials/account/accountdialog",targetEvent:t,locals:{items:e.items}}).then(function(n){switch(n.a){case 1:var i=new l;i.password=n.items.password,i.$update({id:t},function(e){o.show(o.simple().content(e?e.message:"Password Updated error."))});case 2:var i=new a;i.username=n.items.username,i.type=n.items.type,e.progress=!0,i.$update({id:t},function(t){t?0==t.code?List(r,{},function(n){e.accounts=n,e.progress=!1,o.show(o.simple().content(t.message))}):o.show(o.simple().content(t.message)):o.show(o.simple().content("account Updated error."))})}},function(){})):o.show(o.simple().content(i.message)))})},e.$on("Login",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})}),e.$on("Logout",function(){e.accounts=[]}),e.$on("Update",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})})):t.go("start")}]),controllers.controller("DepartmentsController",["$scope","$state","$mdDialog","$mdToast","CurrentView","ViewCreate","View","ViewQuery",function(e,t,n,o,a,r,i,l){e.progress=!0,List(l,{},function(t){e.Departments=t,e.progress=!1}),e.back=function(){window.history.back()},e.showDepartmentCreateDialog=function(){n.show({controller:"DepartmentCreateDialogController",templateUrl:"/backend/partials/edit/departmentcreatedialog",targetEvent:null}).then(function(t){var n=new r;n.Name=t.items.department,n.$save({},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})},e.showDepartmentCopyDialog=function(t){var a=new i;a.$get({id:t},function(t){n.show({controller:"DepartmentCopyDialogController",templateUrl:"/backend/partials/edit/departmentcopydialog",targetEvent:null,locals:{items:a}}).then(function(n){var a=new r;a.Pages=t.value.Pages,a.Name=n.items.department,a.$save({},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})})},e.DepartmentUpdate=function(n){var o=new i;o.$get({id:n},function(n){a.Data=n.value,e.Pages=a.Data.Pages,t.go("department")})},e.showDepartmentDeleteDialog=function(t){n.show({controller:"DepartmentDeleteDialogController",templateUrl:"/backend/partials/edit/departmentdeletedialog",targetEvent:t}).then(function(n){var a=new i;e.progress=!0,a.$remove({id:t},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})}}]),controllers.controller("DepartmentEditController",["$scope","$state","$mdDialog","$mdToast","CurrentView","View",function(e,t,n,o,a,r){e.Pages=a.Data.Pages,e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e-1],a.Data.Pages[e-1]=t}},e.down=function(e){if(e<a.Data.Pages.length-1){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e+1],a.Data.Pages[e+1]=t}},e.DepartmentUpdate=function(){var e=new r;e.Name=a.Data.Name,e.Pages=a.Data.Pages,e.$update({id:a.Data._id},function(e){o.show(o.simple().content(e?0==e.code?e.message:e.message:"account Updated error."))})},e.showPageCreateDialog=function(){n.show({controller:"PageCreateDialogController",templateUrl:"/backend/partials/edit/pagecreatedialog",targetEvent:null}).then(function(e){var t=e.items.title,n={headline:t,items:[],picture:[]};a.Data.Pages.push(n)},function(){})},e.PageUpdate=function(e){a.Page=e,t.go("page")},e.showPageDeleteDialog=function(t){n.show({controller:"PageDeleteDialogController",templateUrl:"/backend/partials/edit/pagedeletedialog",targetEvent:t}).then(function(n){a.Data.Pages[t]=null,a.Data.Pages=_.compact(a.Data.Pages),e.Pages=a.Data.Pages},function(){})}}]),controllers.controller("PageEditController",["$scope","$state","$mdDialog","CurrentView","View",function(e,t,n,o,a){e.Page=o.Data.Pages[o.Page],e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e-1],o.Data.Pages[o.Page].items[e-1]=t}},e.down=function(e){if(e<o.Data.Pages[o.Page].items.length-1){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e+1],o.Data.Pages[o.Page].items[e+1]=t}},e.showTextCreateDialog=function(){n.show({controller:"TextCreateDialogController",templateUrl:"/backend/partials/edit/item/text/textcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"text",items:[{name:"required",message:"Required"},{name:"md-maxlength",message:"Max"}]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showCheckCreateDialog=function(){n.show({controller:"CheckCreateDialogController",templateUrl:"/backend/partials/edit/item/check/checkcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name+"-"+e.items.label,model:"",type:"check"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showSelectCreateDialog=function(){n.show({controller:"SelectCreateDialogController",templateUrl:"/backend/partials/edit/item/select/selectcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"select",items:e.tags};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showNumericCreateDialog=function(){n.show({controller:"NumericCreateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"numeric"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showPictureCreateDialog=function(){n.show({controller:"PictureCreateDialogController",templateUrl:"/backend/partials/edit/item/picture/picturecreatedialog",targetEvent:null}).then(function(e){var t={height:600,width:300,path:"images/schema.png",type:"picture",model:"",name:"痛いところ",label:""};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showButtonCreateDialog=function(){var e={type:"button",validate:!0,"class":"md-accent"};n.show({controller:"ButtonCreateDialogController",templateUrl:"/backend/partials/edit/item/button/buttoncreatedialog",targetEvent:null,locals:{items:e}}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"button",validate:e.items.validate,path:e.items.path,"class":e.items["class"]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showTextUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"TextUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/textupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showCheckUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];t.name=t.name.split("-")[0],n.show({controller:"CheckUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/checkupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){t.items.name=t.items.name+"-"+t.items.label,o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showSelectUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"SelectUpdateDialogController",templateUrl:"/backend/partials/edit/item/select/selectupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showNumericUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"NumericUpdateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showPictureUpdateDialog=function(e){var t=o.Data.Pages[o.Page].picture[0];n.show({controller:"PictureUpdateDialogController",templateUrl:"/backend/partials/edit/item/picture/pictureupdatedialog",targetEvent:null,locals:{items:t}}).then(function(e){o.Data.Pages[o.Page].picture[0]=e.items},function(){})},e.showButtonUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"ButtonUpdateDialogController",templateUrl:"/backend/partials/edit/item/button/buttonupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showTextDeleteDialog=function(e){n.show({controller:"TextDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/textdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showCheckDeleteDialog=function(e){n.show({controller:"CheckDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/checkdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showSelectDeleteDialog=function(e){n.show({controller:"SelectDeleteDialogController",templateUrl:"/backend/partials/edit/item/select/selectdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showNumericDeleteDialog=function(e){n.show({controller:"NumericDeleteDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showPictureDeleteDialog=function(e){n.show({controller:"PictureDeleteDialogController",templateUrl:"/backend/partials/edit/item/picture/picturedeletedialog",targetEvent:e}).then(function(e){o.Data.Pages[o.Page].picture[0]=null,o.Data.Pages[o.Page].picture=_.compact(o.Data.Pages[o.Page].picture)},function(){})},e.showButtonDeleteDialog=function(e){n.show({controller:"ButtonDeleteDialogController",templateUrl:"/backend/partials/edit/item/button/buttondeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})}}]),controllers.controller("ControllpanelController",["$scope","$mdToast","$mdBottomSheet","$mdDialog","Config",function(e,t,n,o,a){var r=new a;r.$get({},function(n){n?0==n.code?e.config=n.value:t.show(t.simple().content(n.message)):t.show(t.simple().content("config get error."))}),e.showNotificationDialog=function(){o.show({controller:"NotificationDialogController",templateUrl:"/backend/partials/controll/notification",targetEvent:""}).then(function(n){var o=new a;o.body=e.config,o.$update({},function(e){t.show(t.simple().content(0==e.code?"Updated.":e.message))})},function(){})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){
e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})}}]),controllers.controller("PatientSheetControl",["$scope","$mdBottomSheet","$location","CurrentPatient","Pdf",function(e,t,n,o,a){o&&(e.items=[{name:"Archive",icon:"archive"},{name:"Mail",icon:"mail"},{name:"Message",icon:"message"},{name:"Copy",icon:"content_copy"},{name:"Create",icon:"create"},{name:"Inbox",icon:"inbox"}],e.ItemClick=function(n){t.hide(e.items[n]);var r=new a;r.$get({id:o.id},function(e){window.location.href="/output/"+e.value})})}]),controllers.controller("LoginDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("RegisterDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.iconsize="42",e.onEnter=function(){e.iconsize="52"},e.onLeave=function(){e.iconsize="42"},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.changePassword=function(n){e.a=1,t.hide(e)},e.answer=function(n){e.a=2,t.hide(e)}}]),controllers.controller("NotificationDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PatientAcceptDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.items=o,e.categories=[],e.progress=!0,List(n,{},function(t){_.each(t,function(t,n){e.categories.push(t.Name)}),e.progress=!1}),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCreateDialogController",["$scope","$mdDialog","ViewQuery",function(e,t,n){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCopyDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectCreateDialogController",["$scope","$mdDialog",function(e,t){var n=_this;n.tags=[],e.tags=angular.copy(n.tags),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureCreateDialogController",["$scope","$mdDialog","$timeout","Upload",function(e,t,n,o){e.showUpload=function(){fileUpload(e,t,n,"a")},e.hide=function(){o.hide()},e.cancel=function(){o.cancel()},e.answer=function(t){o.hide(e)}}]),controllers.controller("ButtonCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]);var app=angular.module("PatientsApplication",["ui.router","PatientsControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"Test"},e.state("browseS",{url:"/browseS",templateUrl:"/front/partials/browseS",controller:"BrowseSController"}).state("browse",{url:"/browse/:page",templateUrl:function(e){return e.page,"/front/partials/browse"},controller:"BrowseController"}).state("write",{url:"/write",templateUrl:"/front/partials/write",controller:"WriteController"}),t.otherwise("partials/browseS")}]),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もう少し短くしてください.";break;case"itai":t="痛い";break;case"shibire":t="痺れ";break;case"hare":t="腫れ";break;case"clear":t="消す"}return t}});var controllers=angular.module("PatientsControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate"]),Browser=function(){function e(){this.name=window.navigator.userAgent.toLowerCase(),this.isIE=this.name.indexOf("msie")>=0||this.name.indexOf("trident")>=0,this.isiPhone=this.name.indexOf("iphone")>=0,this.isiPod=this.name.indexOf("ipod")>=0,this.isiPad=this.name.indexOf("ipad")>=0,this.isiOS=this.isiPhone||this.isiPod||this.isiPad,this.isAndroid=this.name.indexOf("android")>=0,this.isPhone=this.isiOS||this.isAndroid,this.isTablet=this.isiPad||this.isAndroid&&this.name.indexOf("mobile")<0,this.isIE&&(this.verArray=/(msie|rv:?)\s?([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isiOS&&(this.verArray=/(os)\s([0-9]{1,})([\_0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isAndroid&&(this.verArray=/(android)\s([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10)))}return e}();controllers.value("Global",{socket:null}),controllers.value("Views",{Data:[]}),controllers.value("CurrentPatient",{Information:{name:"",insurance:""},Status:"",Category:"",Input:{},Sequential:0}),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.controller("BrowseSController",["$scope","$stateParams","$location","Patient","PatientQuery","CurrentPatient","Global","ViewQuery","Views",function(e,t,n,o,a,r,i,l,c){List(l,{},function(t){PatientsList(a,{},function(n){e.patients=n,c.Data=t})}),e.next=function(t){var a=new o;a.$get({id:t},function(o){null!=o&&0==o.code&&(r.id=t,r.Category=o.value.Category,r.Information=o.value.Information,r.Sequential=o.value.Sequential,e.Information=r.Information,e.Input=r.Input,e.Sequential=r.Sequential,n.path("/browse/0"))})},null==i.socket&&(i.socket=io.connect()),i.socket.on("client",function(t){"1"===t.value&&PatientsList(a,{},function(t){e.patients=t})})}]),controllers.controller("BrowseController",["$scope","$stateParams","$location","CurrentPatient","Views",function(e,t,n,o,a){e.Input=o.Input;var r=t.page,i="rgba(200, 20, 30, 0.4)",l=_.filter(a.Data,function(e){return e.Name==o.Category});if(e.contents=l[0].Pages[r],e.contents.picture.length>0){var c=new fabric.Canvas("schema");_.map(e.contents.picture,function(t,n){c.setBackgroundImage(t.path,c.renderAll.bind(c),{backgroundImageOpacity:1,backgroundImageStretch:!1}),null==e.Input[t.name]&&fabric.Image.fromURL(t.path,function(e){});var o=JSON.stringify(e.Input[t.name]);c.loadFromJSON(o,c.renderAll.bind(c),function(e,t){})}),c.on({"touch:gesture":function(e){},"touch:drag":function(e){},"touch:orientation":function(e){},"touch:shake":function(e){},"touch:longpress":function(e){},"mouse:up":function(e){var t=20,n=new Browser;if(n.isTablet)var o=new fabric.Circle({radius:t,fill:i,left:e.e.changedTouches[0].clientX-t/2-c._offset.left,top:e.e.changedTouches[0].clientY-t/2-c._offset.top});else var o=new fabric.Circle({radius:t,fill:i,left:e.e.layerX-t/2,top:e.e.layerY-t/2});c.add(o)}})}e.clearPicture=function(){c.clear().renderAll()},e.setColor=function(e){i=e},e.next=function(t){_.map(e.contents.items,function(t,n){if("check"==t.type){var o=t.name.split("-"),a=o[1];t.model||(a=!1),e.Input[t.name]={name:o[0],value:a,type:t.type}}else e.Input[t.name]={name:t.name,value:t.model,type:t.type}}),_.map(e.contents.picture,function(t,n){e.Input[t.name]={name:t.name,value:c.toJSON(),type:t.type}}),o.Input=e.Input,n.path(t)}}]),controllers.controller("ConfirmController",["$scope","$stateParams","CurrentPatient","Patient","Global",function(e,t,n,o,a){e.Input=n.Input}]),controllers.controller("WriteController",["$scope","$stateParams","$location","CurrentPatient","Patient","Global",function(e,t,n,o,a,r){e.Input=o.Input,e.send=!0;var i=new a;i.Input=o.Input,i.Sequential=o.Sequential,i.Status="Accepted",i.$update({id:o.id},function(t,a){o.Input={},n.path("/browseS"),r.socket.emit("server",{value:"1"}),e.send=!1})}]);var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","ngFileUpload"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","pascalprecht.translate"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});var _this=this,controllers=angular.module("AccountControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate","ngFileUpload"]);controllers.value("Global",{socket:null}),controllers.value("CurrentPatient",{id:""}),controllers.value("CurrentView",{Page:0,Data:{}}),controllers.value("CurrentAccount",{username:"",type:""}),controllers.factory("ViewItem",["$resource",function(e){return e("/view",{},{})}]),controllers.factory("Login",["$resource",function(e){return e("/account/login",{},{login:{method:"POST"}})}]),controllers.factory("Logout",["$resource",function(e){return e("/account/logout",{},{logout:{method:"POST"}})}]),controllers.factory("AccountQuery",["$resource",function(e){return e("/account/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Account",["$resource",function(e){return e("/account/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("AccountPassword",["$resource",function(e){return e("/account/password/:id",{},{update:{method:"PUT"}})}]),controllers.factory("AccountCreate",["$resource",function(e){return e("/account/create",{},{})}]),controllers.factory("PatientAccept",["$resource",function(e){return e("/patient/accept",{},{})}]),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("PatientCount",["$resource",function(e){return e("/patient/count/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("PatientStatus",["$resource",function(e){return e("/patient/status/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewCreate",["$resource",function(e){return e("/view/create",{},{})}]),controllers.factory("View",["$resource",function(e){return e("/view/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Config",["$resource",function(e){return e("/config",{},{update:{method:"PUT"}})}]),controllers.factory("Pdf",["$resource",function(e){return e("/pdf/:id",{},{})}]),controllers.controller("StartController",["$scope","$state","CurrentAccount",function(e,t,n){""!=n.username?(e.username=n.username,e.type=n.type):t.go("start")}]),controllers.controller("ApplicationController",["$scope","$rootScope","$state","$mdDialog","$mdToast","Login","Logout","CurrentAccount","Global",function(e,t,n,o,a,r,i,l,c){if(e.goBack=function(){window.history.back()},e.goTop=function(){n.go("start")},e.goConfig=function(){n.go("controlles")},e.goEdit=function(){n.go("departments")},e.goPatient=function(){e.mode="Patient",n.go("patients")},e.goAccount=function(){e.mode="Account",n.go("accounts")},e.showLoginDialog=function(){o.show({controller:"LoginDialogController",templateUrl:"/backend/partials/account/logindialog",targetEvent:null}).then(function(n){var o=new r;o.username=n.items.username,o.password=n.items.password,o.$login(function(n){n?(0==n.code&&(l.username=n.value.username,l.type=n.value.type,e.username=n.value.username,e.type=n.value.type,localStorage.setItem("account",JSON.stringify(l)),t.$broadcast("Login")),a.show(a.simple().content(n.message))):a.show(a.simple().content("login error"))})},function(){})},e.Logout=function(){var o=new i;o.$logout(function(o){o?(0==o.code&&(l.username="",l.type="",e.username="",e.type="",localStorage.removeItem("account"),t.$broadcast("Logout"),n.go("start")),a.show(a.simple().content(o.message))):a.show(a.simple().content("logout error"))})},null==c.socket&&(c.socket=io.connect()),null!=localStorage.getItem("account")){var s=JSON.parse(localStorage.getItem("account"));l.username=s.username,l.type=s.type}else e.showLoginDialog();e.username=l.username,e.type=l.type,e.mode="Account"}]),controllers.controller("PatientsController",["$scope","$state","$mdDialog","$mdBottomSheet","$mdToast","Patient","PatientAccept","PatientQuery","PatientCount","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,r,i,l,c,s,u,p){""!=s.username?(e.username=s.username,e.type=s.type,e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1}),e.showPatientDescription=function(e){u.id=e,t.go("description")},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",o.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showPatientAcceptDialog=function(t){var o=TodayQuery();c.query({query:encodeURIComponent(JSON.stringify(o))},function(o){if(o&&0==o.code){var r={count:0};r.count=o.value,n.show({controller:"PatientAcceptDialogController",templateUrl:"/backend/partials/patient/patientacceptdialog",targetEvent:t,locals:{items:r}}).then(function(t){var n=new i;n.Input={},n.Information={},n.Information.name=t.items.name;var o=new Date,c=("0"+o.getHours()).slice(-2),s=("0"+o.getMinutes()).slice(-2),u=("0"+o.getSeconds()).slice(-2);n.Information.time=c+":"+s+":"+u,t.items.kana=t.items.kana.replace(/[ぁ-ん]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}),n.Information.kana=t.items.kana,n.Information.insurance=t.items.insurance,n.Category=t.items.category,n.Sequential=r.count,e.progress=!0,n.$save({},function(t){t?0==t.code?PatientsList(l,{},function(n){e.progress=!1,p.socket.emit("server",{value:"1"}),e.patients=n,a.show(a.simple().content(t.message))}):a.show(a.simple().content(t.message)):a.show(a.simple().content("save error"))})},function(){})}})},e.$on("Login",function(){e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1})}),e.$on("Logout",function(){s.username="",s.type="",e.patients=[]}),e.$on("Update",function(){e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1})}),p.socket.on("client",function(t){"1"===t.value&&(e.progress=!0,PatientsList(l,{},function(t){e.patients=t,e.progress=!1}))})):t.go("start")}]),controllers.controller("DescriptionController",["$scope","$mdBottomSheet","$mdToast","Patient","PatientStatus","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,r,i,l){if(i){e.selectedIndex=0,e.$watch("selectedIndex",function(t,a){var r=new o;r.$get({id:i.id},function(t){t?0==t.code?(e.Input=[],_.each(t.value.Input,function(n,o,a){if("picture"==n.type){var r=new fabric.Canvas("schema");r.loadFromJSON(JSON.stringify(n.value),r.renderAll.bind(r),function(e,t){})}e.Input.push(n),e.Information=t.value.Information})):n.show(n.simple().content(t.message)):n.show(n.simple().content("patient error"))})});var c=new a;c.$get({id:i.id},function(t){t?0==t.code?e.IsDone="Done"==t.value:n.show(n.simple().content(t.message)):n.show(n.simple().content("patient status error"))}),e.icon="vertical_align_top",e.showSheet=function(n){e.icon="vertical_align_bottom",t.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:n}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.done=function(){var e=new o;e.$remove({id:i.id},function(e){n.show(n.simple().content(e?e.message:"remove patient error"))})},e.download=function(e){var t=document.getElementById("schema");Canvas2Image.saveAsPNG(t)},e.$watch("IsDone",function(){if(null!=e.IsDone){var t=new a;t.$get({id:i.id},function(o){o?0==o.code?1==e.IsDone?"Done"!=o.value&&(t.Status="Done",t.$update({id:i.id},function(e){e?(0==e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content("Status Updated."))):n.show(n.simple().content("status update error"))})):"Accepted"!=o.value&&(t.Status="Accepted",t.$update({id:i.id},function(e){e?(0==e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content(e.message))):n.show(n.simple().content("login error"))})):n.show(n.simple().content(o.message)):n.show(n.simple().content("login error"))})}})}}]),controllers.controller("AccountsController",["$scope","$state","$mdDialog","$mdToast","Account","AccountQuery","AccountCreate","AccountPassword","CurrentAccount",function(e,t,n,o,a,r,i,l,c){""!=c.username?(e.username=c.username,e.type=c.type,e.progress=!0,List(r,{},function(t){e.progress=!1,e.accounts=t}),e.showRegisterDialog=function(){n.show({controller:"RegisterDialogController",templateUrl:"/backend/partials/account/registerdialog",targetEvent:null}).then(function(t){var n=new i;n.username=t.items.username,n.password=t.items.password,n.type=t.items.type,e.progress=!0,n.$save({},function(t){t?(0==t.code&&List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountDeleteDialog=function(t){n.show({controller:"AccountDeleteDialogController",templateUrl:"/backend/partials/account/deletedialog",targetEvent:t}).then(function(n){var i=new a;e.progress=!0,i.$remove({id:t},function(t){t?0==t.code&&(List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountUpdateDialog=function(t){var i=new a;i.$get({id:t},function(i){i&&(0==i.code?(e.items=i.value,e.items.password="",n.show({controller:"AccountUpdateDialogController",templateUrl:"/backend/partials/account/accountdialog",targetEvent:t,locals:{items:e.items}}).then(function(n){switch(n.a){case 1:var i=new l;i.password=n.items.password,i.$update({id:t},function(e){o.show(o.simple().content(e?e.message:"Password Updated error."))});case 2:var i=new a;i.username=n.items.username,i.type=n.items.type,e.progress=!0,i.$update({id:t},function(t){t?0==t.code?List(r,{},function(n){e.accounts=n,e.progress=!1,o.show(o.simple().content(t.message))}):o.show(o.simple().content(t.message)):o.show(o.simple().content("account Updated error."))})}},function(){})):o.show(o.simple().content(i.message)))})},e.$on("Login",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})}),e.$on("Logout",function(){e.accounts=[]}),e.$on("Update",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})})):t.go("start")}]),controllers.controller("DepartmentsController",["$scope","$state","$mdDialog","$mdToast","CurrentView","ViewCreate","View","ViewQuery",function(e,t,n,o,a,r,i,l){e.progress=!0,List(l,{},function(t){e.Departments=t,e.progress=!1}),e.back=function(){window.history.back()},e.showDepartmentCreateDialog=function(){n.show({controller:"DepartmentCreateDialogController",templateUrl:"/backend/partials/edit/departmentcreatedialog",targetEvent:null}).then(function(t){var n=new r;n.Name=t.items.department,n.$save({},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})},e.showDepartmentCopyDialog=function(t){var a=new i;a.$get({id:t},function(t){n.show({controller:"DepartmentCopyDialogController",templateUrl:"/backend/partials/edit/departmentcopydialog",targetEvent:null,locals:{items:a}}).then(function(n){var a=new r;a.Pages=t.value.Pages,a.Name=n.items.department,a.$save({},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})})},e.DepartmentUpdate=function(n){var o=new i;o.$get({id:n},function(n){a.Data=n.value,e.Pages=a.Data.Pages,t.go("department")})},e.showDepartmentDeleteDialog=function(t){n.show({controller:"DepartmentDeleteDialogController",templateUrl:"/backend/partials/edit/departmentdeletedialog",targetEvent:t}).then(function(n){var a=new i;e.progress=!0,a.$remove({id:t},function(t){t?0==t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})}}]),controllers.controller("DepartmentEditController",["$scope","$state","$mdDialog","$mdToast","CurrentView","View",function(e,t,n,o,a,r){e.Pages=a.Data.Pages,e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e-1],a.Data.Pages[e-1]=t}},e.down=function(e){if(e<a.Data.Pages.length-1){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e+1],a.Data.Pages[e+1]=t}},e.DepartmentUpdate=function(){var e=new r;e.Name=a.Data.Name,e.Pages=a.Data.Pages,e.$update({id:a.Data._id},function(e){o.show(o.simple().content(e?0==e.code?e.message:e.message:"account Updated error."))})},e.showPageCreateDialog=function(){n.show({controller:"PageCreateDialogController",templateUrl:"/backend/partials/edit/pagecreatedialog",targetEvent:null}).then(function(e){var t=e.items.title,n={headline:t,items:[],picture:[]};a.Data.Pages.push(n)},function(){})},e.PageUpdate=function(e){a.Page=e,t.go("page")},e.showPageDeleteDialog=function(t){n.show({controller:"PageDeleteDialogController",templateUrl:"/backend/partials/edit/pagedeletedialog",targetEvent:t}).then(function(n){a.Data.Pages[t]=null,a.Data.Pages=_.compact(a.Data.Pages),e.Pages=a.Data.Pages},function(){})}}]),controllers.controller("PageEditController",["$scope","$state","$mdDialog","CurrentView","View",function(e,t,n,o,a){e.Page=o.Data.Pages[o.Page],e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e-1],o.Data.Pages[o.Page].items[e-1]=t}},e.down=function(e){if(e<o.Data.Pages[o.Page].items.length-1){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e+1],o.Data.Pages[o.Page].items[e+1]=t}},e.showTextCreateDialog=function(){n.show({controller:"TextCreateDialogController",templateUrl:"/backend/partials/edit/item/text/textcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"text",items:[{name:"required",message:"Required"},{name:"md-maxlength",message:"Max"}]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showCheckCreateDialog=function(){n.show({controller:"CheckCreateDialogController",templateUrl:"/backend/partials/edit/item/check/checkcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name+"-"+e.items.label,model:"",type:"check"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showSelectCreateDialog=function(){n.show({controller:"SelectCreateDialogController",templateUrl:"/backend/partials/edit/item/select/selectcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"select",items:e.tags};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showNumericCreateDialog=function(){n.show({controller:"NumericCreateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"numeric"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showPictureCreateDialog=function(){n.show({
controller:"PictureCreateDialogController",templateUrl:"/backend/partials/edit/item/picture/picturecreatedialog",targetEvent:null}).then(function(e){var t={height:600,width:300,path:"images/schema.png",type:"picture",model:"",name:"痛いところ",label:""};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showButtonCreateDialog=function(){var e={type:"button",validate:!0,"class":"md-accent"};n.show({controller:"ButtonCreateDialogController",templateUrl:"/backend/partials/edit/item/button/buttoncreatedialog",targetEvent:null,locals:{items:e}}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"button",validate:e.items.validate,path:e.items.path,"class":e.items["class"]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showTextUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"TextUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/textupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showCheckUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];t.name=t.name.split("-")[0],n.show({controller:"CheckUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/checkupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){t.items.name=t.items.name+"-"+t.items.label,o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showSelectUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"SelectUpdateDialogController",templateUrl:"/backend/partials/edit/item/select/selectupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showNumericUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"NumericUpdateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showPictureUpdateDialog=function(e){var t=o.Data.Pages[o.Page].picture[0];n.show({controller:"PictureUpdateDialogController",templateUrl:"/backend/partials/edit/item/picture/pictureupdatedialog",targetEvent:null,locals:{items:t}}).then(function(e){o.Data.Pages[o.Page].picture[0]=e.items},function(){})},e.showButtonUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"ButtonUpdateDialogController",templateUrl:"/backend/partials/edit/item/button/buttonupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showTextDeleteDialog=function(e){n.show({controller:"TextDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/textdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showCheckDeleteDialog=function(e){n.show({controller:"CheckDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/checkdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showSelectDeleteDialog=function(e){n.show({controller:"SelectDeleteDialogController",templateUrl:"/backend/partials/edit/item/select/selectdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showNumericDeleteDialog=function(e){n.show({controller:"NumericDeleteDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showPictureDeleteDialog=function(e){n.show({controller:"PictureDeleteDialogController",templateUrl:"/backend/partials/edit/item/picture/picturedeletedialog",targetEvent:e}).then(function(e){o.Data.Pages[o.Page].picture[0]=null,o.Data.Pages[o.Page].picture=_.compact(o.Data.Pages[o.Page].picture)},function(){})},e.showButtonDeleteDialog=function(e){n.show({controller:"ButtonDeleteDialogController",templateUrl:"/backend/partials/edit/item/button/buttondeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})}}]),controllers.controller("ControllpanelController",["$scope","$mdToast","$mdBottomSheet","$mdDialog","Config",function(e,t,n,o,a){var r=new a;r.$get({},function(n){n?0==n.code?e.config=n.value:t.show(t.simple().content(n.message)):t.show(t.simple().content("config get error."))}),e.showNotificationDialog=function(){o.show({controller:"NotificationDialogController",templateUrl:"/backend/partials/controll/notification",targetEvent:""}).then(function(n){var o=new a;o.body=e.config,o.$update({},function(e){t.show(t.simple().content(0==e.code?"Updated.":e.message))})},function(){})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})}}]),controllers.controller("PatientSheetControl",["$scope","$mdBottomSheet","$location","CurrentPatient","Pdf",function(e,t,n,o,a){o&&(e.items=[{name:"Archive",icon:"archive"},{name:"Mail",icon:"mail"},{name:"Message",icon:"message"},{name:"Copy",icon:"content_copy"},{name:"Create",icon:"create"},{name:"Inbox",icon:"inbox"}],e.ItemClick=function(n){t.hide(e.items[n]);var r=new a;r.$get({id:o.id},function(e){window.location.href="/output/"+e.value})})}]),controllers.controller("LoginDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("RegisterDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.iconsize="42",e.onEnter=function(){e.iconsize="52"},e.onLeave=function(){e.iconsize="42"},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.changePassword=function(n){e.a=1,t.hide(e)},e.answer=function(n){e.a=2,t.hide(e)}}]),controllers.controller("NotificationDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PatientAcceptDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.items=o,e.categories=[],e.progress=!0,List(n,{},function(t){_.each(t,function(t,n){e.categories.push(t.Name)}),e.progress=!1}),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCreateDialogController",["$scope","$mdDialog","ViewQuery",function(e,t,n){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCopyDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectCreateDialogController",["$scope","$mdDialog",function(e,t){var n=_this;n.tags=[],e.tags=angular.copy(n.tags),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureCreateDialogController",["$scope","$mdDialog","Upload",function(e,t,n){e.upload=function(t){n.upload({url:"upload/url",fields:{username:e.username},file:t}).progress(function(e){var t=parseInt(100*e.loaded/e.total);console.log("progress: "+t+"% "+e.config.file.name)}).success(function(e,t,n,o){console.log("file "+o.file.name+"uploaded. Response: "+e)}).error(function(e,t,n,o){console.log("error status: "+t)})},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]);var app=angular.module("PatientsApplication",["ui.router","PatientsControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("browseS",{url:"/browseS",templateUrl:"/front/partials/browseS",controller:"BrowseSController"}).state("browse",{url:"/browse/:page",templateUrl:function(e){return e.page,"/front/partials/browse"},controller:"BrowseController"}).state("write",{url:"/write",templateUrl:"/front/partials/write",controller:"WriteController"}),t.otherwise("partials/browseS")}]),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もう少し短くしてください.";break;case"itai":t="痛い";break;case"shibire":t="痺れ";break;case"hare":t="腫れ";break;case"clear":t="消す"}return t}});var controllers=angular.module("PatientsControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate"]),Browser=function(){function e(){this.name=window.navigator.userAgent.toLowerCase(),this.isIE=this.name.indexOf("msie")>=0||this.name.indexOf("trident")>=0,this.isiPhone=this.name.indexOf("iphone")>=0,this.isiPod=this.name.indexOf("ipod")>=0,this.isiPad=this.name.indexOf("ipad")>=0,this.isiOS=this.isiPhone||this.isiPod||this.isiPad,this.isAndroid=this.name.indexOf("android")>=0,this.isPhone=this.isiOS||this.isAndroid,this.isTablet=this.isiPad||this.isAndroid&&this.name.indexOf("mobile")<0,this.isIE&&(this.verArray=/(msie|rv:?)\s?([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isiOS&&(this.verArray=/(os)\s([0-9]{1,})([\_0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isAndroid&&(this.verArray=/(android)\s([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10)))}return e}();controllers.value("Global",{socket:null}),controllers.value("Views",{Data:[]}),controllers.value("CurrentPatient",{Information:{name:"",insurance:""},Status:"",Category:"",Input:{},Sequential:0}),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.controller("BrowseSController",["$scope","$stateParams","$location","Patient","PatientQuery","CurrentPatient","Global","ViewQuery","Views",function(e,t,n,o,a,r,i,l,c){List(l,{},function(t){PatientsList(a,{},function(n){e.patients=n,c.Data=t})}),e.next=function(t){var a=new o;a.$get({id:t},function(o){null!=o&&0==o.code&&(r.id=t,r.Category=o.value.Category,r.Information=o.value.Information,r.Sequential=o.value.Sequential,e.Information=r.Information,e.Input=r.Input,e.Sequential=r.Sequential,n.path("/browse/0"))})},null==i.socket&&(i.socket=io.connect()),i.socket.on("client",function(t){"1"===t.value&&PatientsList(a,{},function(t){e.patients=t})})}]),controllers.controller("BrowseController",["$scope","$stateParams","$location","CurrentPatient","Views",function(e,t,n,o,a){e.Input=o.Input;var r=t.page,i="rgba(200, 20, 30, 0.4)",l=_.filter(a.Data,function(e){return e.Name==o.Category});if(e.contents=l[0].Pages[r],e.contents.picture.length>0){var c=new fabric.Canvas("schema");_.map(e.contents.picture,function(t,n){c.setBackgroundImage(t.path,c.renderAll.bind(c),{backgroundImageOpacity:1,backgroundImageStretch:!1}),null==e.Input[t.name]&&fabric.Image.fromURL(t.path,function(e){});var o=JSON.stringify(e.Input[t.name]);c.loadFromJSON(o,c.renderAll.bind(c),function(e,t){})}),c.on({"touch:gesture":function(e){},"touch:drag":function(e){},"touch:orientation":function(e){},"touch:shake":function(e){},"touch:longpress":function(e){},"mouse:up":function(e){var t=20,n=new Browser;if(n.isTablet)var o=new fabric.Circle({radius:t,fill:i,left:e.e.changedTouches[0].clientX-t/2-c._offset.left,top:e.e.changedTouches[0].clientY-t/2-c._offset.top});else var o=new fabric.Circle({radius:t,fill:i,left:e.e.layerX-t/2,top:e.e.layerY-t/2});c.add(o)}})}e.clearPicture=function(){c.clear().renderAll()},e.setColor=function(e){i=e},e.next=function(t){_.map(e.contents.items,function(t,n){if("check"==t.type){var o=t.name.split("-"),a=o[1];t.model||(a=!1),e.Input[t.name]={name:o[0],value:a,type:t.type}}else e.Input[t.name]={name:t.name,value:t.model,type:t.type}}),_.map(e.contents.picture,function(t,n){e.Input[t.name]={name:t.name,value:c.toJSON(),type:t.type}}),o.Input=e.Input,n.path(t)}}]),controllers.controller("ConfirmController",["$scope","$stateParams","CurrentPatient","Patient","Global",function(e,t,n,o,a){e.Input=n.Input}]),controllers.controller("WriteController",["$scope","$stateParams","$location","CurrentPatient","Patient","Global",function(e,t,n,o,a,r){e.Input=o.Input,e.send=!0;var i=new a;i.Input=o.Input,i.Sequential=o.Sequential,i.Status="Accepted",i.$update({id:o.id},function(t,a){o.Input={},n.path("/browseS"),r.socket.emit("server",{value:"1"}),e.send=!1})}]);var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:function(e){var t=e.id;return"/backend/partials/patient/description/"+t},controller:"DescriptionController",params:{id:null}}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("blue-grey").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}});var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","pascalprecht.translate"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,n){n.debugInfoEnabled(!1),e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});var _this=this,controllers=angular.module("AccountControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate","flow"]);controllers.value("Global",{socket:null}),controllers.value("CurrentPatient",{id:""}),controllers.value("CurrentView",{Page:0,Data:{}}),controllers.value("CurrentAccount",{username:"",type:""}),controllers.factory("ViewItem",["$resource",function(e){return e("/view",{},{})}]),controllers.factory("Login",["$resource",function(e){return e("/account/login",{},{login:{method:"POST"}})}]),controllers.factory("Logout",["$resource",function(e){return e("/account/logout",{},{logout:{method:"POST"}})}]),controllers.factory("AccountQuery",["$resource",function(e){return e("/account/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Account",["$resource",function(e){return e("/account/:id",{},{get:{method:"GET"},update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("AccountPassword",["$resource",function(e){return e("/account/password/:id",{},{update:{method:"PUT"}})}]),controllers.factory("AccountCreate",["$resource",function(e){return e("/account/create",{},{})}]),controllers.factory("PatientAccept",["$resource",function(e){return e("/patient/accept",{},{})}]),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("PatientCount",["$resource",function(e){return e("/patient/count/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("PatientStatus",["$resource",function(e){return e("/patient/status/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewCreate",["$resource",function(e){return e("/view/create",{},{})}]),controllers.factory("View",["$resource",function(e){return e("/view/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Config",["$resource",function(e){return e("/config",{},{update:{method:"PUT"}})}]),controllers.factory("File",["$resource",function(e){return e("/file/:name",{name:"@name"},{send:{method:"POST"},update:{method:"PUT"}})}]),controllers.factory("Pdf",["$resource",function(e){return e("/pdf/:id",{},{})}]),controllers.controller("StartController",["$scope","$state","CurrentAccount",function(e,t,n){""!==n.username?(e.username=n.username,e.type=n.type):t.go("start")}]),controllers.controller("ApplicationController",["$scope","$rootScope","$state","$mdDialog","$mdToast","$mdSidenav","$mdUtil","Login","Logout","CurrentAccount","Global",function(e,t,n,o,a,r,i,l,c,s,u){function p(){var e=i.debounce(function(){r("nav").toggle().then(function(){})},300);return e}if(e.goBack=function(){window.history.back()},e.goTop=function(){n.go("start")},e.goConfig=function(){n.go("controlles")},e.goEdit=function(){n.go("departments")},e.goPatient=function(){e.mode="Patient",n.go("patients")},e.goAccount=function(){e.mode="Account",n.go("accounts")},e.open=p(),e.close=function(){r("nav").close().then(function(){})},e.showLoginDialog=function(){o.show({controller:"LoginDialogController",templateUrl:"/backend/partials/account/logindialog",targetEvent:null}).then(function(n){var o=new l;o.username=n.items.username,o.password=n.items.password,o.$login(function(n){n?(0===n.code&&(s.username=n.value.username,s.type=n.value.type,e.username=n.value.username,e.type=n.value.type,localStorage.setItem("account",JSON.stringify(s)),t.$broadcast("Login")),a.show(a.simple().content(n.message))):a.show(a.simple().content("login error"))})},function(){})},e.Logout=function(){var o=new c;o.$logout(function(o){o?(0===o.code&&(s.username="",s.type="",e.username="",e.type="",localStorage.removeItem("account"),t.$broadcast("Logout"),n.go("start")),a.show(a.simple().content(o.message))):a.show(a.simple().content("logout error"))})},null===u.socket&&(u.socket=io.connect()),null!==localStorage.getItem("account")){var d=JSON.parse(localStorage.getItem("account"));s.username=d.username,s.type=d.type}else e.showLoginDialog();e.username=s.username,e.type=s.type,e.mode="Account"}]),controllers.controller("PatientsController",["$scope","$state","$stateParams","$q","$mdDialog","$mdBottomSheet","$mdToast","Patient","PatientAccept","PatientQuery","PatientCount","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,r,i,l,c,s,u,p,d,m){""!==p.username?(e.username=p.username,e.type=p.type,e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1}),e.showPatientDescription=function(e){d.id=e,n.id=e,t.go("description",{id:e})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",r.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showPatientAcceptDialog=function(t){var n=TodayQuery();u.query({query:encodeURIComponent(JSON.stringify(n))},function(n){if(n&&0===n.code){var o={count:0};o.count=n.value,a.show({controller:"PatientAcceptDialogController",templateUrl:"/backend/partials/patient/patientacceptdialog",targetEvent:t,locals:{items:o}}).then(function(t){var n=new c;n.Input={},n.Information={},n.Information.name=t.items.name;var a=new Date,r=("0"+a.getHours()).slice(-2),l=("0"+a.getMinutes()).slice(-2),u=("0"+a.getSeconds()).slice(-2);n.Information.time=r+":"+l+":"+u,t.items.kana=t.items.kana.replace(/[ぁ-ん]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}),n.Information.kana=t.items.kana,n.Information.insurance=t.items.insurance,n.Category=t.items.category,n.Sequential=o.count,e.progress=!0,n.$save({},function(t){t?0===t.code?PatientsList(s,{},function(n){e.progress=!1,m.socket.emit("server",{value:"1"}),e.patients=n,i.show(i.simple().content(t.message))}):i.show(i.simple().content(t.message)):i.show(i.simple().content("save error"))})},function(){})}})},e.querySearch=function(e){var t=o.defer(),n=TodayQuery();return s.query({query:encodeURIComponent(JSON.stringify({$and:[n,{"Information.name":{$regex:e}}]}))},function(e){t.resolve(e.value)}),t.promise},e.searchTextChange=function(e){},e.selectedItemChange=function(e){},e.$on("Login",function(){e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1})}),e.$on("Logout",function(){p.username="",p.type="",e.patients=[]}),e.$on("Update",function(){e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1})}),m.socket.on("client",function(t){"1"===t.value&&(e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1}))})):t.go("start")}]),controllers.controller("DescriptionController",["$scope","$mdBottomSheet","$mdToast","Patient","PatientStatus","CurrentAccount","CurrentPatient","Pdf","Global",function(e,t,n,o,a,r,i,l,c){if(i){e.selectedIndex=0,e.load=function(){var t=new o;t.$get({id:i.id},function(t){t?0===t.code?(e.Input=[],_.each(t.value.Input,function(n,o,a){if("picture"===n.type){var r=new fabric.Canvas("schema-"+n.name);r.loadFromJSON(JSON.stringify(n.value),r.renderAll.bind(r),function(e,t){})}e.Input.push(n),e.Information=t.value.Information})):n.show(n.simple().content(t.message)):n.show(n.simple().content("patient error"))})};var s=new a;s.$get({id:i.id},function(t){t?0===t.code?e.IsDone="Done"===t.value:n.show(n.simple().content(t.message)):n.show(n.simple().content("patient status error"))}),e.icon="vertical_align_top",e.showSheet=function(n){e.icon="vertical_align_bottom",t.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:n}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.done=function(){var e=new o;e.$remove({id:i.id},function(e){n.show(n.simple().content(e?e.message:"remove patient error"))})},e.download=function(e){var t=document.getElementById(e);Canvas2Image.saveAsPNG(t)},e.$watch("IsDone",function(){if(null!==e.IsDone){var t=new a;t.$get({id:i.id},function(o){o?0===o.code?e.IsDone===!0?"Done"!==o.value&&(t.Status="Done",t.$update({id:i.id},function(e){e?(0===e.code&&c.socket.emit("server",{value:"1"}),n.show(n.simple().content("Status Updated."))):n.show(n.simple().content("status update error"))})):"Accepted"!==o.value&&(t.Status="Accepted",t.$update({id:i.id},function(e){e?(0===e.code&&c.socket.emit("server",{value:"1"}),n.show(n.simple().content(e.message))):n.show(n.simple().content("login error"))})):n.show(n.simple().content(o.message)):n.show(n.simple().content("login error"))})}})}}]),controllers.controller("AccountsController",["$scope","$state","$mdDialog","$mdToast","Account","AccountQuery","AccountCreate","AccountPassword","CurrentAccount",function(e,t,n,o,a,r,i,l,c){""!==c.username?(e.username=c.username,e.type=c.type,e.progress=!0,List(r,{},function(t){e.progress=!1,e.accounts=t}),e.showRegisterDialog=function(){n.show({controller:"RegisterDialogController",templateUrl:"/backend/partials/account/registerdialog",targetEvent:null}).then(function(t){var n=new i;n.username=t.items.username,n.password=t.items.password,n.type=t.items.type,e.progress=!0,n.$save({},function(t){t?(0===t.code&&List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountDeleteDialog=function(t){n.show({controller:"AccountDeleteDialogController",templateUrl:"/backend/partials/account/deletedialog",targetEvent:t}).then(function(n){var i=new a;e.progress=!0,i.$remove({id:t},function(t){t?0===t.code&&(List(r,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountUpdateDialog=function(t){var i=new a;i.$get({id:t},function(i){i&&(0===i.code?(e.items=i.value,e.items.password="",n.show({controller:"AccountUpdateDialogController",templateUrl:"/backend/partials/account/accountdialog",targetEvent:t,locals:{items:e.items}}).then(function(n){switch(n.a){case 1:var i=new l;i.password=n.items.password,i.$update({id:t},function(e){o.show(o.simple().content(e?e.message:"Password Updated error."))});case 2:var i=new a;i.username=n.items.username,i.type=n.items.type,e.progress=!0,i.$update({id:t},function(t){t?0===t.code?List(r,{},function(n){
e.accounts=n,e.progress=!1,o.show(o.simple().content(t.message))}):o.show(o.simple().content(t.message)):o.show(o.simple().content("account Updated error."))})}},function(){})):o.show(o.simple().content(i.message)))})},e.$on("Login",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})}),e.$on("Logout",function(){e.accounts=[]}),e.$on("Update",function(){e.progress=!0,List(r,{},function(t){e.accounts=t,e.progress=!1})})):t.go("start")}]),controllers.controller("DepartmentsController",["$scope","$state","$mdDialog","$mdToast","CurrentView","ViewCreate","View","ViewQuery",function(e,t,n,o,a,r,i,l){e.progress=!0,List(l,{},function(t){e.Departments=t,e.progress=!1}),e.back=function(){window.history.back()},e.showDepartmentCreateDialog=function(){n.show({controller:"DepartmentCreateDialogController",templateUrl:"/backend/partials/edit/departmentcreatedialog",targetEvent:null}).then(function(t){var n=new r;n.Name=t.items.department,n.$save({},function(t){t?0===t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})},e.showDepartmentCopyDialog=function(t){var a=new i;a.$get({id:t},function(t){n.show({controller:"DepartmentCopyDialogController",templateUrl:"/backend/partials/edit/departmentcopydialog",targetEvent:null,locals:{items:a}}).then(function(n){var a=new r;a.Pages=t.value.Pages,a.Name=n.items.department,a.$save({},function(t){t?0===t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})})},e.DepartmentUpdate=function(n){var o=new i;o.$get({id:n},function(n){a.Data=n.value,e.Pages=a.Data.Pages,t.go("department")})},e.showDepartmentDeleteDialog=function(t){n.show({controller:"DepartmentDeleteDialogController",templateUrl:"/backend/partials/edit/departmentdeletedialog",targetEvent:t}).then(function(n){var a=new i;e.progress=!0,a.$remove({id:t},function(t){t?0===t.code?(e.progress=!0,List(l,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})}}]),controllers.controller("DepartmentEditController",["$scope","$state","$mdDialog","$mdToast","CurrentView","View",function(e,t,n,o,a,r){a.Data?(e.Pages=a.Data.Pages,e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e-1],a.Data.Pages[e-1]=t}},e.down=function(e){if(e<a.Data.Pages.length-1){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e+1],a.Data.Pages[e+1]=t}},e.DepartmentUpdate=function(){var e=new r;e.Name=a.Data.Name,e.Pages=a.Data.Pages,e.$update({id:a.Data._id},function(e){o.show(o.simple().content(e?0===e.code?e.message:e.message:"account Updated error."))})},e.showPageCreateDialog=function(){n.show({controller:"PageCreateDialogController",templateUrl:"/backend/partials/edit/pagecreatedialog",targetEvent:null}).then(function(t){var n=t.items.title,o={headline:n,items:[],picture:[]};a.Data.Pages||(a.Data.Pages=[]),a.Data.Pages.push(o),e.Pages=a.Data.Pages},function(){})},e.PageUpdate=function(e){a.Page=e,t.go("page")},e.showPageDeleteDialog=function(t){n.show({controller:"PageDeleteDialogController",templateUrl:"/backend/partials/edit/pagedeletedialog",targetEvent:t}).then(function(n){a.Data.Pages[t]=null,a.Data.Pages=_.compact(a.Data.Pages),e.Pages=a.Data.Pages},function(){})}):t.go("departments")}]),controllers.controller("PageEditController",["$scope","$state","$mdDialog","CurrentView","View",function(e,t,n,o,a){o.Data.Pages?(e.Page=o.Data.Pages[o.Page],e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e-1],o.Data.Pages[o.Page].items[e-1]=t}},e.down=function(e){if(e<o.Data.Pages[o.Page].items.length-1){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e+1],o.Data.Pages[o.Page].items[e+1]=t}},e.showTextCreateDialog=function(){n.show({controller:"TextCreateDialogController",templateUrl:"/backend/partials/edit/item/text/textcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"text",items:[{name:"required",message:"Required"},{name:"md-maxlength",message:"Max"}]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showCheckCreateDialog=function(){n.show({controller:"CheckCreateDialogController",templateUrl:"/backend/partials/edit/item/check/checkcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name+"-"+e.items.label,model:"",type:"check"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showSelectCreateDialog=function(){n.show({controller:"SelectCreateDialogController",templateUrl:"/backend/partials/edit/item/select/selectcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"select",items:e.tags};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showNumericCreateDialog=function(){n.show({controller:"NumericCreateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"numeric"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showPictureCreateDialog=function(){n.show({controller:"PictureCreateDialogController",templateUrl:"/backend/partials/edit/item/picture/picturecreatedialog",targetEvent:null}).then(function(e){var t={height:600,width:300,path:e.items.path,type:"picture",model:"",name:e.items.name,label:e.items.label};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showPictureUpdateDialog=function(e){var t=o.Data.Pages[o.Page].picture[0];n.show({controller:"PictureUpdateDialogController",templateUrl:"/backend/partials/edit/item/picture/pictureupdatedialog",targetEvent:null,locals:{items:t}}).then(function(e){var t={height:600,width:300,path:e.items.path,type:"picture",model:"",name:e.items.name,label:e.items.label};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showButtonCreateDialog=function(){var e={type:"button",validate:!0,"class":"md-accent"};n.show({controller:"ButtonCreateDialogController",templateUrl:"/backend/partials/edit/item/button/buttoncreatedialog",targetEvent:null,locals:{items:e}}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"button",validate:e.items.validate,path:e.items.path,"class":e.items["class"]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showTextUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"TextUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/textupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showCheckUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];t.name=t.name.split("-")[0],n.show({controller:"CheckUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/checkupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){t.items.name=t.items.name+"-"+t.items.label,o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showSelectUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"SelectUpdateDialogController",templateUrl:"/backend/partials/edit/item/select/selectupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showNumericUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"NumericUpdateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showButtonUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"ButtonUpdateDialogController",templateUrl:"/backend/partials/edit/item/button/buttonupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showTextDeleteDialog=function(e){n.show({controller:"TextDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/textdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showCheckDeleteDialog=function(e){n.show({controller:"CheckDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/checkdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showSelectDeleteDialog=function(e){n.show({controller:"SelectDeleteDialogController",templateUrl:"/backend/partials/edit/item/select/selectdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showNumericDeleteDialog=function(e){n.show({controller:"NumericDeleteDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showPictureDeleteDialog=function(e){n.show({controller:"PictureDeleteDialogController",templateUrl:"/backend/partials/edit/item/picture/picturedeletedialog",targetEvent:e}).then(function(e){o.Data.Pages[o.Page].picture[0]=null,o.Data.Pages[o.Page].picture=_.compact(o.Data.Pages[o.Page].picture)},function(){})},e.showButtonDeleteDialog=function(e){n.show({controller:"ButtonDeleteDialogController",templateUrl:"/backend/partials/edit/item/button/buttondeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})}):t.go("departments")}]),controllers.controller("ControllpanelController",["$scope","$mdToast","$mdBottomSheet","$mdDialog","Config",function(e,t,n,o,a){var r=new a;r.$get({},function(n){n?0===n.code?e.config=n.value:t.show(t.simple().content(n.message)):t.show(t.simple().content("config get error."))}),e.showNotificationDialog=function(){o.show({controller:"NotificationDialogController",templateUrl:"/backend/partials/controll/notification",targetEvent:""}).then(function(n){var o=new a;o.body=e.config,o.$update({},function(e){t.show(t.simple().content(0===e.code?"Updated.":e.message))})},function(){})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showTotalSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/totalsheet",controller:"PatientTotalSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})}}]),controllers.controller("PatientSheetControl",["$scope","$mdBottomSheet","$location","CurrentPatient",function(e,t,n,o){o&&(e.items=[{name:"PDF",icon:"content_copy"}],e.ItemClick=function(n){t.hide(e.items[n]),window.open("/pdf/"+o.id,o.name,"location=no")})}]),controllers.controller("PatientTotalSheetControl",["$scope","$mdBottomSheet","$location",function(e,t,n){e.items=[],e.ItemClick=function(n){t.hide(e.items[n])}}]),controllers.controller("LoginDialogController",["$scope","$q","$mdDialog","AccountQuery",function(e,t,n,o){e.querySearch=function(e){var n=t.defer();return o.query({query:encodeURIComponent(JSON.stringify({username:{$regex:e}}))},function(e){n.resolve(e.value)}),n.promise},e.searchTextChange=function(e){},e.selectedItemChange=function(e){},e.hide=function(){n.hide()},e.cancel=function(){n.cancel()},e.answer=function(t){n.hide(e)}}]),controllers.controller("RegisterDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.iconsize="42",e.onEnter=function(){e.iconsize="52"},e.onLeave=function(){e.iconsize="42"},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.changePassword=function(n){e.a=1,t.hide(e)},e.answer=function(n){e.a=2,t.hide(e)}}]),controllers.controller("NotificationDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PatientAcceptDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.items=o,e.categories=[],e.progress=!0,List(n,{},function(t){_.each(t,function(t,n){e.categories.push(t.Name)}),e.progress=!1}),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCreateDialogController",["$scope","$mdDialog","ViewQuery",function(e,t,n){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCopyDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectCreateDialogController",["$scope","$mdDialog",function(e,t){var n=_this;n.tags=[],e.tags=angular.copy(n.tags),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureCreateDialogController",["$scope","$mdDialog","File",function(e,t,n){e.images=[],e.processFiles=function(t){e.images[0]={};var o=new FileReader,a=new Image;o.onload=function(t){var o=t.target.result;a.src=o,a.onload=function(){var t=new n;t.url=o,t.$send({name:e.items.path}),e.$apply()}},o.readAsDataURL(t[0].file)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureUpdateDialogController",["$scope","$mdDialog","File","items",function(e,t,n,o){e.images=[],e.items=o,e.processFiles=function(t){e.images[0]={};var o=new FileReader,a=new Image;o.onload=function(t){var o=t.target.result;a.src=o,a.onload=function(){var t=new n;t.url=o,t.$update({name:e.items.path}),e.$apply()}},o.readAsDataURL(t[0].file)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]);var app=angular.module("PatientsApplication",["ui.router","PatientsControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,t,n,o){n.debugInfoEnabled(!1),o.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("browseS",{url:"/browseS",templateUrl:"/front/partials/browseS",controller:"BrowseSController"}).state("browse",{url:"/browse/:page",templateUrl:function(e){return e.page,"/front/partials/browse"},controller:"BrowseController"}).state("write",{url:"/write",templateUrl:"/front/partials/write",controller:"WriteController"}),t.otherwise("partials/browseS")}]),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もう少し短くしてください.";break;case"itai":t="痛い";break;case"shibire":t="痺れ";break;case"hare":t="腫れ";break;case"clear":t="消す"}return t}});var controllers=angular.module("PatientsControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate"]),Browser=function(){function e(){this.name=window.navigator.userAgent.toLowerCase(),this.isIE=this.name.indexOf("msie")>=0||this.name.indexOf("trident")>=0,this.isiPhone=this.name.indexOf("iphone")>=0,this.isiPod=this.name.indexOf("ipod")>=0,this.isiPad=this.name.indexOf("ipad")>=0,this.isiOS=this.isiPhone||this.isiPod||this.isiPad,this.isAndroid=this.name.indexOf("android")>=0,this.isPhone=this.isiOS||this.isAndroid,this.isTablet=this.isiPad||this.isAndroid&&this.name.indexOf("mobile")<0,this.isIE&&(this.verArray=/(msie|rv:?)\s?([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isiOS&&(this.verArray=/(os)\s([0-9]{1,})([\_0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isAndroid&&(this.verArray=/(android)\s([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10)))}return e}();controllers.value("Global",{socket:null}),controllers.value("Views",{Data:[]}),controllers.value("CurrentPatient",{Information:{name:"",insurance:""},Status:"",Category:"",Input:{},Sequential:0}),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.controller("BrowseSController",["$scope","$stateParams","$location","Patient","PatientQuery","CurrentPatient","Global","ViewQuery","Views",function(e,t,n,o,a,r,i,l,c){List(l,{},function(t){PatientsList(a,function(n){e.patients=n,c.Data=t})}),e.next=function(t){var a=new o;a.$get({id:t},function(o){null!=o&&0==o.code&&(r.id=t,r.Category=o.value.Category,r.Information=o.value.Information,r.Sequential=o.value.Sequential,e.Information=r.Information,e.Input=r.Input,e.Sequential=r.Sequential,n.path("/browse/0"))})},null==i.socket&&(i.socket=io.connect()),i.socket.on("client",function(t){"1"===t.value&&PatientsList(a,function(t){e.patients=t})})}]),controllers.controller("BrowseController",["$scope","$stateParams","$location","CurrentPatient","Views",function(e,t,n,o,a){e.Input=o.Input;var r=t.page,i="rgba(200, 20, 30, 0.4)",l=_.filter(a.Data,function(e){return e.Name==o.Category});if(e.contents=l[0].Pages[r],e.contents.picture.length>0){var c=new fabric.Canvas("schema");_.map(e.contents.picture,function(t,n){c.setBackgroundImage("/file/"+t.path,c.renderAll.bind(c),{backgroundImageOpacity:1,backgroundImageStretch:!1}),null==e.Input[t.name]&&fabric.Image.fromURL("/file/"+t.path,function(e){});var o=JSON.stringify(e.Input[t.name]);c.loadFromJSON(o,c.renderAll.bind(c),function(e,t){})}),c.on({"touch:gesture":function(e){},"touch:drag":function(e){},"touch:orientation":function(e){},"touch:shake":function(e){},"touch:longpress":function(e){},"mouse:up":function(e){var t=20,n=new Browser;if(n.isTablet)var o=new fabric.Circle({radius:t,fill:i,left:e.e.changedTouches[0].clientX-t/2-c._offset.left,top:e.e.changedTouches[0].clientY-t/2-c._offset.top});else var o=new fabric.Circle({radius:t,fill:i,left:e.e.layerX-t/2,top:e.e.layerY-t/2});c.add(o)}})}e.clearPicture=function(){c.clear().renderAll()},e.setColor=function(e){i=e},e.next=function(t){_.map(e.contents.items,function(t,n){if("check"==t.type){var o=t.name.split("-"),a=o[1];t.model||(a=!1),e.Input[t.name]={name:o[0],value:a,type:t.type}}else e.Input[t.name]={name:t.name,value:t.model,type:t.type}}),_.map(e.contents.picture,function(t,n){e.Input[t.name]={name:t.name,value:c.toJSON(),type:t.type}}),o.Input=e.Input,n.path(t)}}]),controllers.controller("ConfirmController",["$scope","$stateParams","CurrentPatient","Patient","Global",function(e,t,n,o,a){e.Input=n.Input}]),controllers.controller("WriteController",["$scope","$stateParams","$location","CurrentPatient","Patient","Global",function(e,t,n,o,a,r){e.Input=o.Input,e.send=!0;var i=new a;i.Input=o.Input,i.Sequential=o.Sequential,i.Status="Accepted",i.$update({id:o.id},function(t,a){o.Input={},n.path("/browseS"),r.socket.emit("server",{value:"1"}),e.send=!1})}]);
"use strict";var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(t,e,r,a){r.debugInfoEnabled(!1),a.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},t.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:function(t){var e=t.id;return"/backend/partials/patient/description/"+e},controller:"DescriptionController",params:{id:null}}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),e.otherwise("/start")}]),app.config(["$mdThemingProvider",function(t){t.theme("default").primaryPalette("blue-grey").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(t){var e="fill:#000000";switch(t){case"Admin":e="fill:#abcdff";break;case"Editor":e="fill:#abfdef";break;case"Viewer":e="fill:#fbcdef"}return e}}),app.filter("status",function(){return function(t){var e="";switch(t){case"Init":e="受付済み";break;case"Accepted":e="問診済み";break;case"Done":e="診療済み"}return e}});
"use strict";var app=angular.module("AccountApplication",["ui.router","AccountControllers","TopControllers","pascalprecht.translate"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider",function(e,t,a){a.debugInfoEnabled(!1),e.state("start",{url:"/start",templateUrl:"/backend/partials/patient/start",controller:"StartController"}).state("patients",{url:"/patients",templateUrl:"/backend/partials/patient/patients",controller:"PatientsController"}).state("description",{url:"/description",templateUrl:"/backend/partials/patient/description",controller:"DescriptionController"}).state("accounts",{url:"/accounts",templateUrl:"/backend/partials/account/accounts",controller:"AccountsController"}).state("controlles",{url:"/controlles",templateUrl:"/backend/partials/controll/panel",controller:"ControllpanelController"}).state("error",{url:"/error",templateUrl:"/backend/partials/error",controller:"ErrorController"}).state("departments",{url:"/departments",templateUrl:"/backend/partials/edit/departments",controller:"DepartmentsController"}).state("department",{url:"/department",templateUrl:"/backend/partials/edit/department",controller:"DepartmentEditController"}).state("page",{url:"/page",templateUrl:"/backend/partials/edit/page",controller:"PageEditController"}),t.otherwise("/start")}]),app.config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("indigo").accentPalette("orange").warnPalette("red")}]),app.filter("rgb",function(){return function(e){var t="fill:#000000";switch(e){case"Admin":t="fill:#abcdff";break;case"Editor":t="fill:#abfdef";break;case"Viewer":t="fill:#fbcdef"}return t}}),app.filter("status",function(){return function(e){var t="";switch(e){case"Init":t="受付済み";break;case"Accepted":t="問診済み";break;case"Done":t="診療済み"}return t}}),app.filter("message",function(){return function(e){var t="?????";switch(e){case"required":t="必ず入力してください.";break;case"maxlength":t="もうすこし短くしてください.";break;case"notkana":t="カナで入力してください.";break;case"notnumeric":t="半角数字で入力してください.";break;case"less10d":t="10文字以内にしてください.";break;case"accept":t="受付";break;case"patientid":t="患者ID";break;case"kana":t="カナ";break;case"name":t="名前";break;case"cancel":t="キャンセル";break;case"password":t="パスワード";break;case"save":t="保存";break;case"changepass":t="パスワード変更";break;case"stuff":t="スタッフ";break;case"patient":t="患者";break;case"top":t="トップ";break;case"config":t="コンフィグ";break;case"login":t="ログイン";break;case"logout":t="ログアウト";break;case"add":t="追加...";break;case"opentools":t="ツール..."}return t}});
"use strict";function TodayQuery(){var e=new Date;e.setHours(23,59,59,99);var t=new Date;return t.setHours(0,0,0,1),{$and:[{Date:{$lte:e}},{Date:{$gt:t}}]}}function PatientsList(e,t,n){var t=TodayQuery();e.query({query:encodeURIComponent(JSON.stringify(t))},function(e,t){e&&0===e.code&&n(e.value,t)})}function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0===e.code&&n(e.value)})}var _this=this,controllers=angular.module("AccountControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate","flow"]);controllers.value("Global",{socket:null}),controllers.value("CurrentPatient",{id:""}),controllers.value("CurrentView",{Page:0,Data:{}}),controllers.value("CurrentAccount",{username:"",type:""}),controllers.factory("ViewItem",["$resource",function(e){return e("/view",{},{})}]),controllers.factory("Login",["$resource",function(e){return e("/account/login",{},{login:{method:"POST"}})}]),controllers.factory("Logout",["$resource",function(e){return e("/account/logout",{},{logout:{method:"POST"}})}]),controllers.factory("AccountQuery",["$resource",function(e){return e("/account/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Account",["$resource",function(e){return e("/account/:id",{},{get:{method:"GET"},update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("AccountPassword",["$resource",function(e){return e("/account/password/:id",{},{update:{method:"PUT"}})}]),controllers.factory("AccountCreate",["$resource",function(e){return e("/account/create",{},{})}]),controllers.factory("PatientAccept",["$resource",function(e){return e("/patient/accept",{},{})}]),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("PatientCount",["$resource",function(e){return e("/patient/count/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("PatientStatus",["$resource",function(e){return e("/patient/status/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewCreate",["$resource",function(e){return e("/view/create",{},{})}]),controllers.factory("View",["$resource",function(e){return e("/view/:id",{},{update:{method:"PUT"},remove:{method:"DELETE"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Config",["$resource",function(e){return e("/config",{},{update:{method:"PUT"}})}]),controllers.factory("File",["$resource",function(e){return e("/file/:name",{name:"@name"},{send:{method:"POST"},update:{method:"PUT"}})}]),controllers.factory("Pdf",["$resource",function(e){return e("/pdf/:id",{},{})}]),controllers.controller("StartController",["$scope","$state","CurrentAccount",function(e,t,n){""!==n.username?(e.username=n.username,e.type=n.type):t.go("start")}]),controllers.controller("ApplicationController",["$scope","$rootScope","$state","$mdDialog","$mdToast","$mdSidenav","$mdUtil","Login","Logout","CurrentAccount","Global",function(e,t,n,o,a,i,r,c,l,s,u){function g(){var e=r.debounce(function(){i("nav").toggle().then(function(){})},300);return e}if(e.goBack=function(){window.history.back()},e.goTop=function(){n.go("start")},e.goConfig=function(){n.go("controlles")},e.goEdit=function(){n.go("departments")},e.goPatient=function(){e.mode="Patient",n.go("patients")},e.goAccount=function(){e.mode="Account",n.go("accounts")},e.open=g(),e.close=function(){i("nav").close().then(function(){})},e.showLoginDialog=function(){o.show({controller:"LoginDialogController",templateUrl:"/backend/partials/account/logindialog",targetEvent:null}).then(function(n){var o=new c;o.username=n.items.username,o.password=n.items.password,o.$login(function(n){n?(0===n.code&&(s.username=n.value.username,s.type=n.value.type,e.username=n.value.username,e.type=n.value.type,localStorage.setItem("account",JSON.stringify(s)),t.$broadcast("Login")),a.show(a.simple().content(n.message))):a.show(a.simple().content("login error"))})},function(){})},e.Logout=function(){var o=new l;o.$logout(function(o){o?(0===o.code&&(s.username="",s.type="",e.username="",e.type="",localStorage.removeItem("account"),t.$broadcast("Logout"),n.go("start")),a.show(a.simple().content(o.message))):a.show(a.simple().content("logout error"))})},null===u.socket&&(u.socket=io.connect()),null!==localStorage.getItem("account")){var m=JSON.parse(localStorage.getItem("account"));s.username=m.username,s.type=m.type}else e.showLoginDialog();e.username=s.username,e.type=s.type,e.mode="Account"}]),controllers.controller("PatientsController",["$scope","$state","$stateParams","$q","$mdDialog","$mdBottomSheet","$mdToast","Patient","PatientAccept","PatientQuery","PatientCount","CurrentAccount","CurrentPatient","Global",function(e,t,n,o,a,i,r,c,l,s,u,g,m,d){""!==g.username?(e.username=g.username,e.type=g.type,e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1}),e.showPatientDescription=function(e){m.id=e,n.id=e,t.go("description",{id:e})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",i.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showPatientAcceptDialog=function(t){var n=TodayQuery();u.query({query:encodeURIComponent(JSON.stringify(n))},function(n){if(n&&0===n.code){var o={count:0};o.count=n.value,a.show({controller:"PatientAcceptDialogController",templateUrl:"/backend/partials/patient/patientacceptdialog",targetEvent:t,locals:{items:o}}).then(function(t){var n=new l;n.Input={},n.Information={},n.Information.name=t.items.name;var a=new Date,i=("0"+a.getHours()).slice(-2),c=("0"+a.getMinutes()).slice(-2),u=("0"+a.getSeconds()).slice(-2);n.Information.time=i+":"+c+":"+u,t.items.kana=t.items.kana.replace(/[ぁ-ん]/g,function(e){return String.fromCharCode(e.charCodeAt(0)+96)}),n.Information.kana=t.items.kana,n.Information.insurance=t.items.insurance,n.Category=t.items.category,n.Sequential=o.count,e.progress=!0,n.$save({},function(t){t?0===t.code?PatientsList(s,{},function(n){e.progress=!1,d.socket.emit("server",{value:"1"}),e.patients=n,r.show(r.simple().content(t.message))}):r.show(r.simple().content(t.message)):r.show(r.simple().content("save error"))})},function(){})}})},e.querySearch=function(e){var t=o.defer(),n=TodayQuery();return s.query({query:encodeURIComponent(JSON.stringify({$and:[n,{"Information.name":{$regex:e}}]}))},function(e){t.resolve(e.value)}),t.promise},e.searchTextChange=function(e){},e.selectedItemChange=function(e){},e.$on("Login",function(){e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1})}),e.$on("Logout",function(){g.username="",g.type="",e.patients=[]}),e.$on("Update",function(){e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1})}),d.socket.on("client",function(t){"1"===t.value&&(e.progress=!0,PatientsList(s,{},function(t){e.patients=t,e.progress=!1}))})):t.go("start")}]),controllers.controller("DescriptionController",["$scope","$mdBottomSheet","$mdToast","Patient","PatientStatus","CurrentAccount","CurrentPatient","Pdf","Global",function(e,t,n,o,a,i,r,c,l){if(r){e.selectedIndex=0,e.load=function(){var t=new o;t.$get({id:r.id},function(t){t?0===t.code?(e.Input=[],_.each(t.value.Input,function(n,o,a){if("picture"===n.type){var i=new fabric.Canvas("schema-"+n.name);i.loadFromJSON(JSON.stringify(n.value),i.renderAll.bind(i),function(e,t){})}e.Input.push(n),e.Information=t.value.Information})):n.show(n.simple().content(t.message)):n.show(n.simple().content("patient error"))})};var s=new a;s.$get({id:r.id},function(t){t?0===t.code?e.IsDone="Done"===t.value:n.show(n.simple().content(t.message)):n.show(n.simple().content("patient status error"))}),e.icon="vertical_align_top",e.showSheet=function(n){e.icon="vertical_align_bottom",t.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:n}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.done=function(){var e=new o;e.$remove({id:r.id},function(e){n.show(e?n.simple().content(e.message):n.simple().content("remove patient error"))})},e.download=function(e){var t=document.getElementById(e);Canvas2Image.saveAsPNG(t)},e.$watch("IsDone",function(){if(null!==e.IsDone){var t=new a;t.$get({id:r.id},function(o){o?0===o.code?e.IsDone===!0?"Done"!==o.value&&(t.Status="Done",t.$update({id:r.id},function(e){e?(0===e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content("Status Updated."))):n.show(n.simple().content("status update error"))})):"Accepted"!==o.value&&(t.Status="Accepted",t.$update({id:r.id},function(e){e?(0===e.code&&l.socket.emit("server",{value:"1"}),n.show(n.simple().content(e.message))):n.show(n.simple().content("login error"))})):n.show(n.simple().content(o.message)):n.show(n.simple().content("login error"))})}})}}]),controllers.controller("AccountsController",["$scope","$state","$mdDialog","$mdToast","Account","AccountQuery","AccountCreate","AccountPassword","CurrentAccount",function(e,t,n,o,a,i,r,c,l){""!==l.username?(e.username=l.username,e.type=l.type,e.progress=!0,List(i,{},function(t){e.progress=!1,e.accounts=t}),e.showRegisterDialog=function(){n.show({controller:"RegisterDialogController",templateUrl:"/backend/partials/account/registerdialog",targetEvent:null}).then(function(t){var n=new r;n.username=t.items.username,n.password=t.items.password,n.type=t.items.type,e.progress=!0,n.$save({},function(t){t?(0===t.code&&List(i,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountDeleteDialog=function(t){n.show({controller:"AccountDeleteDialogController",templateUrl:"/backend/partials/account/deletedialog",targetEvent:t}).then(function(n){var r=new a;e.progress=!0,r.$remove({id:t},function(t){t?0===t.code&&(List(i,{},function(t){e.accounts=t,e.progress=!1}),o.show(o.simple().content(t.message))):o.show(o.simple().content("Status Updated."))})},function(){})},e.showAccountUpdateDialog=function(t){var r=new a;r.$get({id:t},function(r){r&&(0===r.code?(e.items=r.value,e.items.password="",n.show({controller:"AccountUpdateDialogController",templateUrl:"/backend/partials/account/accountdialog",targetEvent:t,locals:{items:e.items}}).then(function(n){switch(n.a){case 1:var r=new c;r.password=n.items.password,r.$update({id:t},function(e){o.show(e?o.simple().content(e.message):o.simple().content("Password Updated error."))});case 2:var r=new a;r.username=n.items.username,r.type=n.items.type,e.progress=!0,r.$update({id:t},function(t){t?0===t.code?List(i,{},function(n){e.accounts=n,e.progress=!1,o.show(o.simple().content(t.message))}):o.show(o.simple().content(t.message)):o.show(o.simple().content("account Updated error."))})}},function(){})):o.show(o.simple().content(r.message)))})},e.$on("Login",function(){e.progress=!0,List(i,{},function(t){e.accounts=t,e.progress=!1})}),e.$on("Logout",function(){e.accounts=[]}),e.$on("Update",function(){e.progress=!0,List(i,{},function(t){e.accounts=t,e.progress=!1})})):t.go("start")}]),controllers.controller("DepartmentsController",["$scope","$state","$mdDialog","$mdToast","CurrentView","ViewCreate","View","ViewQuery",function(e,t,n,o,a,i,r,c){e.progress=!0,List(c,{},function(t){e.Departments=t,e.progress=!1}),e.back=function(){window.history.back()},e.showDepartmentCreateDialog=function(){n.show({controller:"DepartmentCreateDialogController",templateUrl:"/backend/partials/edit/departmentcreatedialog",targetEvent:null}).then(function(t){var n=new i;n.Name=t.items.department,n.$save({},function(t){t?0===t.code?(e.progress=!0,List(c,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})},e.showDepartmentCopyDialog=function(t){var a=new r;a.$get({id:t},function(t){n.show({controller:"DepartmentCopyDialogController",templateUrl:"/backend/partials/edit/departmentcopydialog",targetEvent:null,locals:{items:a}}).then(function(n){var a=new i;a.Pages=t.value.Pages,a.Name=n.items.department,a.$save({},function(t){t?0===t.code?(e.progress=!0,List(c,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})})},e.DepartmentUpdate=function(n){var o=new r;o.$get({id:n},function(n){a.Data=n.value,e.Pages=a.Data.Pages,t.go("department")})},e.showDepartmentDeleteDialog=function(t){n.show({controller:"DepartmentDeleteDialogController",templateUrl:"/backend/partials/edit/departmentdeletedialog",targetEvent:t}).then(function(n){var a=new r;e.progress=!0,a.$remove({id:t},function(t){t?0===t.code?(e.progress=!0,List(c,{},function(n){e.Departments=n,e.progress=!1,o.show(o.simple().content(t.message))})):o.show(o.simple().content(t.message)):o.show(o.simple().content("save error"))})},function(){})}}]),controllers.controller("DepartmentEditController",["$scope","$state","$mdDialog","$mdToast","CurrentView","View",function(e,t,n,o,a,i){a.Data?(e.Pages=a.Data.Pages,e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e-1],a.Data.Pages[e-1]=t}},e.down=function(e){if(e<a.Data.Pages.length-1){var t=a.Data.Pages[e];a.Data.Pages[e]=a.Data.Pages[e+1],a.Data.Pages[e+1]=t}},e.DepartmentUpdate=function(){var e=new i;e.Name=a.Data.Name,e.Pages=a.Data.Pages,e.$update({id:a.Data._id},function(e){o.show(e?0===e.code?o.simple().content(e.message):o.simple().content(e.message):o.simple().content("account Updated error."))})},e.showPageCreateDialog=function(){n.show({controller:"PageCreateDialogController",templateUrl:"/backend/partials/edit/pagecreatedialog",targetEvent:null}).then(function(t){var n=t.items.title,o={headline:n,items:[],picture:[]};a.Data.Pages||(a.Data.Pages=[]),a.Data.Pages.push(o),e.Pages=a.Data.Pages},function(){})},e.PageUpdate=function(e){a.Page=e,t.go("page")},e.showPageDeleteDialog=function(t){n.show({controller:"PageDeleteDialogController",templateUrl:"/backend/partials/edit/pagedeletedialog",targetEvent:t}).then(function(n){a.Data.Pages[t]=null,a.Data.Pages=_.compact(a.Data.Pages),e.Pages=a.Data.Pages},function(){})}):t.go("departments")}]),controllers.controller("PageEditController",["$scope","$state","$mdDialog","CurrentView","View",function(e,t,n,o,a){o.Data.Pages?(e.Page=o.Data.Pages[o.Page],e.back=function(){window.history.back()},e.up=function(e){if(e>0){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e-1],o.Data.Pages[o.Page].items[e-1]=t}},e.down=function(e){if(e<o.Data.Pages[o.Page].items.length-1){var t=o.Data.Pages[o.Page].items[e];o.Data.Pages[o.Page].items[e]=o.Data.Pages[o.Page].items[e+1],o.Data.Pages[o.Page].items[e+1]=t}},e.showTextCreateDialog=function(){n.show({controller:"TextCreateDialogController",templateUrl:"/backend/partials/edit/item/text/textcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"text",items:[{name:"required",message:"Required"},{name:"md-maxlength",message:"Max"}]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showCheckCreateDialog=function(){n.show({controller:"CheckCreateDialogController",templateUrl:"/backend/partials/edit/item/check/checkcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name+"-"+e.items.label,model:"",type:"check"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showSelectCreateDialog=function(){n.show({controller:"SelectCreateDialogController",templateUrl:"/backend/partials/edit/item/select/selectcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"select",items:e.tags};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showNumericCreateDialog=function(){n.show({controller:"NumericCreateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericcreatedialog",targetEvent:null}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"numeric"};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showPictureCreateDialog=function(){n.show({controller:"PictureCreateDialogController",templateUrl:"/backend/partials/edit/item/picture/picturecreatedialog",targetEvent:null}).then(function(e){var t={height:600,width:300,path:e.items.path,type:"picture",model:"",name:e.items.name,label:e.items.label};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showPictureUpdateDialog=function(e){var t=o.Data.Pages[o.Page].picture[0];n.show({controller:"PictureUpdateDialogController",templateUrl:"/backend/partials/edit/item/picture/pictureupdatedialog",targetEvent:null,locals:{items:t}}).then(function(e){var t={height:600,width:300,path:e.items.path,type:"picture",model:"",name:e.items.name,label:e.items.label};o.Data.Pages[o.Page].picture[0]=t},function(){})},e.showButtonCreateDialog=function(){var e={type:"button",validate:!0,"class":"md-accent"};n.show({controller:"ButtonCreateDialogController",templateUrl:"/backend/partials/edit/item/button/buttoncreatedialog",targetEvent:null,locals:{items:e}}).then(function(e){var t={label:e.items.label,name:e.items.name,model:"",type:"button",validate:e.items.validate,path:e.items.path,"class":e.items["class"]};o.Data.Pages[o.Page].items.push(t)},function(){})},e.showTextUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"TextUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/textupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showCheckUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];t.name=t.name.split("-")[0],n.show({controller:"CheckUpdateDialogController",templateUrl:"/backend/partials/edit/item/check/checkupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){t.items.name=t.items.name+"-"+t.items.label,o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showSelectUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"SelectUpdateDialogController",templateUrl:"/backend/partials/edit/item/select/selectupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showNumericUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"NumericUpdateDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showButtonUpdateDialog=function(e){var t=o.Data.Pages[o.Page].items[e];n.show({controller:"ButtonUpdateDialogController",templateUrl:"/backend/partials/edit/item/button/buttonupdatedialog",targetEvent:null,locals:{items:t}}).then(function(t){o.Data.Pages[o.Page].items[e]=t.items},function(){})},e.showTextDeleteDialog=function(e){n.show({controller:"TextDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/textdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showCheckDeleteDialog=function(e){n.show({controller:"CheckDeleteDialogController",templateUrl:"/backend/partials/edit/item/check/checkdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showSelectDeleteDialog=function(e){n.show({controller:"SelectDeleteDialogController",templateUrl:"/backend/partials/edit/item/select/selectdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showNumericDeleteDialog=function(e){n.show({controller:"NumericDeleteDialogController",templateUrl:"/backend/partials/edit/item/numeric/numericdeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})},e.showPictureDeleteDialog=function(e){n.show({controller:"PictureDeleteDialogController",templateUrl:"/backend/partials/edit/item/picture/picturedeletedialog",targetEvent:e}).then(function(e){o.Data.Pages[o.Page].picture[0]=null,o.Data.Pages[o.Page].picture=_.compact(o.Data.Pages[o.Page].picture)},function(){})},e.showButtonDeleteDialog=function(e){n.show({controller:"ButtonDeleteDialogController",templateUrl:"/backend/partials/edit/item/button/buttondeletedialog",targetEvent:e}).then(function(t){o.Data.Pages[o.Page].items[e]=null,o.Data.Pages[o.Page].items=_.compact(o.Data.Pages[o.Page].items)},function(){})}):t.go("departments")}]),controllers.controller("ControllpanelController",["$scope","$mdToast","$mdBottomSheet","$mdDialog","Config",function(e,t,n,o,a){var i=new a;i.$get({},function(n){n?0===n.code?e.config=n.value:t.show(t.simple().content(n.message)):t.show(t.simple().content("config get error."))}),e.showNotificationDialog=function(){o.show({controller:"NotificationDialogController",templateUrl:"/backend/partials/controll/notification",targetEvent:""}).then(function(n){var o=new a;o.body=e.config,o.$update({},function(e){t.show(0===e.code?t.simple().content("Updated."):t.simple().content(e.message))})},function(){})},e.icon="vertical_align_top",e.showSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/sheet",controller:"PatientSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})},e.showTotalSheet=function(t){e.icon="vertical_align_bottom",n.show({templateUrl:"/backend/partials/patient/totalsheet",controller:"PatientTotalSheetControl",targetEvent:t}).then(function(t){e.icon="vertical_align_top"},function(){e.icon="vertical_align_top"})}}]),controllers.controller("PatientSheetControl",["$scope","$mdBottomSheet","$location","CurrentPatient",function(e,t,n,o){o&&(e.items=[{name:"PDF",icon:"content_copy"}],e.ItemClick=function(n){t.hide(e.items[n]),window.open("/pdf/"+o.id,o.name,"location=no")})}]),controllers.controller("PatientTotalSheetControl",["$scope","$mdBottomSheet","$location",function(e,t,n){e.items=[],e.ItemClick=function(n){t.hide(e.items[n])}}]),controllers.controller("LoginDialogController",["$scope","$q","$mdDialog","AccountQuery",function(e,t,n,o){e.querySearch=function(e){var n=t.defer();return o.query({query:encodeURIComponent(JSON.stringify({username:{$regex:e}}))},function(e){n.resolve(e.value)}),n.promise},e.searchTextChange=function(e){},e.selectedItemChange=function(e){},e.hide=function(){n.hide()},e.cancel=function(){n.cancel()},e.answer=function(t){n.hide(e)}}]),controllers.controller("RegisterDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("AccountUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.iconsize="42",e.onEnter=function(){e.iconsize="52"},e.onLeave=function(){e.iconsize="42"},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.changePassword=function(n){e.a=1,t.hide(e)},e.answer=function(n){e.a=2,t.hide(e)}}]),controllers.controller("NotificationDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PatientAcceptDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.items=o,e.categories=[],e.progress=!0,List(n,{},function(t){_.each(t,function(t,n){e.categories.push(t.Name)}),e.progress=!1}),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCreateDialogController",["$scope","$mdDialog","ViewQuery",function(e,t,n){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentCopyDialogController",["$scope","$mdDialog","ViewQuery","items",function(e,t,n,o){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("DepartmentDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PageDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectCreateDialogController",["$scope","$mdDialog",function(e,t){var n=_this;n.tags=[],e.tags=angular.copy(n.tags),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureCreateDialogController",["$scope","$mdDialog","File",function(e,t,n){e.images=[],e.processFiles=function(t){e.images[0]={};var o=new FileReader,a=new Image;o.onload=function(t){var o=t.target.result;a.src=o,a.onload=function(){var t=new n;t.url=o,t.$send({name:e.items.path}),e.$apply()}},o.readAsDataURL(t[0].file)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonCreateDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureUpdateDialogController",["$scope","$mdDialog","File","items",function(e,t,n,o){e.images=[],e.items=o,e.processFiles=function(t){e.images[0]={};var o=new FileReader,a=new Image;o.onload=function(t){var o=t.target.result;a.src=o,a.onload=function(){var t=new n;t.url=o,t.$update({name:e.items.path}),e.$apply()}},o.readAsDataURL(t[0].file)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonUpdateDialogController",["$scope","$mdDialog","items",function(e,t,n){e.items=n,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("TextDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("CheckDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("SelectDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("NumericDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("PictureDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]),controllers.controller("ButtonDeleteDialogController",["$scope","$mdDialog",function(e,t){e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(n){t.hide(e)}}]);
"use strict";var app=angular.module("PatientsApplication",["ui.router","PatientsControllers","TopControllers"]);app.config(["$stateProvider","$urlRouterProvider","$compileProvider","$httpProvider",function(e,r,t,a){t.debugInfoEnabled(!1),a.defaults.headers.common={"x-requested-with":"XMLHttpRequest"},e.state("browseS",{url:"/browseS",templateUrl:"/front/partials/browseS",controller:"BrowseSController"}).state("browse",{url:"/browse/:page",templateUrl:function(e){e.page;return"/front/partials/browse"},controller:"BrowseController"}).state("write",{url:"/write",templateUrl:"/front/partials/write",controller:"WriteController"}),r.otherwise("partials/browseS")}]),app.filter("status",function(){return function(e){var r="";switch(e){case"Init":r="受付済み";break;case"Accepted":r="問診済み";break;case"Done":r="診療済み"}return r}}),app.filter("message",function(){return function(e){var r="";switch(e){case"required":r="必ず入力してください.";break;case"maxlength":r="もう少し短くしてください.";break;case"itai":r="痛い";break;case"shibire":r="痺れ";break;case"hare":r="腫れ";break;case"clear":r="消す"}return r}});
"use strict";function List(e,t,n){e.query({query:encodeURIComponent(JSON.stringify(t))},function(e){e&&0==e.code&&n(e.value)})}function PatientsList(e,t){var n=new Date;n.setHours(23,59,59,99);var i=new Date;i.setHours(0,0,0,1);var r={$and:[{Date:{$lte:n}},{Date:{$gt:i}}]};e.query({query:encodeURIComponent(JSON.stringify(r))},function(e,n){null!=e&&0==e.code&&t(e.value,n)})}var controllers=angular.module("PatientsControllers",["ngMaterial","ngResource","ngMessages","ngMdIcons","ngAnimate"]),Browser=function(){function e(){this.name=window.navigator.userAgent.toLowerCase(),this.isIE=this.name.indexOf("msie")>=0||this.name.indexOf("trident")>=0,this.isiPhone=this.name.indexOf("iphone")>=0,this.isiPod=this.name.indexOf("ipod")>=0,this.isiPad=this.name.indexOf("ipad")>=0,this.isiOS=this.isiPhone||this.isiPod||this.isiPad,this.isAndroid=this.name.indexOf("android")>=0,this.isPhone=this.isiOS||this.isAndroid,this.isTablet=this.isiPad||this.isAndroid&&this.name.indexOf("mobile")<0,this.isIE&&(this.verArray=/(msie|rv:?)\s?([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isiOS&&(this.verArray=/(os)\s([0-9]{1,})([\_0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10))),this.isAndroid&&(this.verArray=/(android)\s([0-9]{1,})([\.0-9]{1,})/.exec(this.name),this.verArray&&(this.ver=parseInt(this.verArray[2],10)))}return e}();controllers.value("Global",{socket:null}),controllers.value("Views",{Data:[]}),controllers.value("CurrentPatient",{Information:{name:"",insurance:""},Status:"",Category:"",Input:{},Sequential:0}),controllers.factory("PatientQuery",["$resource",function(e){return e("/patient/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.factory("Patient",["$resource",function(e){return e("/patient/:id",{},{update:{method:"PUT"}})}]),controllers.factory("ViewQuery",["$resource",function(e){return e("/view/query/:query",{query:"@query"},{query:{method:"GET"}})}]),controllers.controller("BrowseSController",["$scope","$stateParams","$location","Patient","PatientQuery","CurrentPatient","Global","ViewQuery","Views",function(e,t,n,i,r,o,a,s,u){List(s,{},function(t){PatientsList(r,function(n){e.patients=n,u.Data=t})}),e.next=function(t){var r=new i;r.$get({id:t},function(i){null!=i&&0==i.code&&(o.id=t,o.Category=i.value.Category,o.Information=i.value.Information,o.Sequential=i.value.Sequential,e.Information=o.Information,e.Input=o.Input,e.Sequential=o.Sequential,n.path("/browse/0"))})},null==a.socket&&(a.socket=io.connect()),a.socket.on("client",function(t){"1"===t.value&&PatientsList(r,function(t){e.patients=t})})}]),controllers.controller("BrowseController",["$scope","$stateParams","$location","CurrentPatient","Views",function(e,t,n,i,r){e.Input=i.Input;var o=t.page,a="rgba(200, 20, 30, 0.4)",s=_.filter(r.Data,function(e){return e.Name==i.Category});if(e.contents=s[0].Pages[o],e.contents.picture.length>0){var u=new fabric.Canvas("schema");_.map(e.contents.picture,function(t,n){u.setBackgroundImage("/file/"+t.path,u.renderAll.bind(u),{backgroundImageOpacity:1,backgroundImageStretch:!1}),null==e.Input[t.name]&&fabric.Image.fromURL("/file/"+t.path,function(e){});var i=JSON.stringify(e.Input[t.name]);u.loadFromJSON(i,u.renderAll.bind(u),function(e,t){})}),u.on({"touch:gesture":function(e){},"touch:drag":function(e){},"touch:orientation":function(e){},"touch:shake":function(e){},"touch:longpress":function(e){},"mouse:up":function(e){var t=20,n=new Browser;if(n.isTablet)var i=new fabric.Circle({radius:t,fill:a,left:e.e.changedTouches[0].clientX-t/2-u._offset.left,top:e.e.changedTouches[0].clientY-t/2-u._offset.top});else var i=new fabric.Circle({radius:t,fill:a,left:e.e.layerX-t/2,top:e.e.layerY-t/2});u.add(i)}})}e.clearPicture=function(){u.clear().renderAll()},e.setColor=function(e){a=e},e.next=function(t){_.map(e.contents.items,function(t,n){if("check"==t.type){var i=t.name.split("-"),r=i[1];t.model||(r=!1),e.Input[t.name]={name:i[0],value:r,type:t.type}}else e.Input[t.name]={name:t.name,value:t.model,type:t.type}}),_.map(e.contents.picture,function(t,n){e.Input[t.name]={name:t.name,value:u.toJSON(),type:t.type}}),i.Input=e.Input,n.path(t)}}]),controllers.controller("ConfirmController",["$scope","$stateParams","CurrentPatient","Patient","Global",function(e,t,n,i,r){e.Input=n.Input}]),controllers.controller("WriteController",["$scope","$stateParams","$location","CurrentPatient","Patient","Global",function(e,t,n,i,r,o){e.Input=i.Input,e.send=!0;var a=new r;a.Input=i.Input,a.Sequential=i.Sequential,a.Status="Accepted",a.$update({id:i.id},function(t,r){i.Input={},n.path("/browseS"),o.socket.emit("server",{value:"1"}),e.send=!1})}]);